<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astroquery.sdss.core &#8212; astroquery v0.4.7.dev9024</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-astropy.css?v=9d21690f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=4195d067"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">query</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">astroquery v0.4.7.dev9024</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >Module code</a> &#187;</li>
      <li><a href="../sdss.html" accesskey="U">astroquery.sdss</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astroquery.sdss.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Access Sloan Digital Sky Survey database online.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span>
<span class="kn">from</span> <span class="nn">astropy.utils.exceptions</span> <span class="kn">import</span> <span class="n">AstropyWarning</span>

<span class="kn">from</span> <span class="nn">..query</span> <span class="kn">import</span> <span class="n">BaseQuery</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">commons</span><span class="p">,</span> <span class="n">async_to_sync</span><span class="p">,</span> <span class="n">prepend_docstr_nosections</span>
<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="kn">import</span> <span class="n">RemoteServiceError</span><span class="p">,</span> <span class="n">NoResultsWarning</span>
<span class="kn">from</span> <span class="nn">.field_names</span> <span class="kn">import</span> <span class="p">(</span><span class="n">photoobj_defs</span><span class="p">,</span> <span class="n">specobj_defs</span><span class="p">,</span>
                          <span class="n">crossid_defs</span><span class="p">,</span> <span class="n">get_field_info</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SDSS&#39;</span><span class="p">,</span> <span class="s1">&#39;SDSSClass&#39;</span><span class="p">]</span>
<span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SDSSClass.*&#39;</span><span class="p">]</span>

<span class="c1"># Imaging pixelscale 0.396 arcsec</span>
<span class="n">sdss_arcsec_per_pixel</span> <span class="o">=</span> <span class="mf">0.396</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">pixel</span>


<div class="viewcode-block" id="SDSSClass">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass">[docs]</a>
<span class="nd">@async_to_sync</span>
<span class="k">class</span> <span class="nc">SDSSClass</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">timeout</span>
    <span class="n">MAX_CROSSID_RADIUS</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span>
    <span class="n">QUERY_URL_SUFFIX_DR_OLD</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/search/x_sql.asp&#39;</span>
    <span class="n">QUERY_URL_SUFFIX_DR_10</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/search/x_sql.aspx&#39;</span>
    <span class="n">QUERY_URL_SUFFIX_DR_NEW</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/search/x_results.aspx&#39;</span>
    <span class="n">XID_URL_SUFFIX_OLD</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/crossid/x_crossid.asp&#39;</span>
    <span class="n">XID_URL_SUFFIX_DR_10</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/crossid/x_crossid.aspx&#39;</span>
    <span class="n">XID_URL_SUFFIX_NEW</span> <span class="o">=</span> <span class="s1">&#39;/dr</span><span class="si">{dr}</span><span class="s1">/en/tools/search/X_Results.aspx&#39;</span>
    <span class="n">IMAGING_URL_SUFFIX</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{base}</span><span class="s1">/dr</span><span class="si">{dr}</span><span class="s1">/</span><span class="si">{instrument}</span><span class="s1">/photoObj/frames/&#39;</span>
                          <span class="s1">&#39;</span><span class="si">{rerun}</span><span class="s1">/</span><span class="si">{run}</span><span class="s1">/</span><span class="si">{camcol}</span><span class="s1">/&#39;</span>
                          <span class="s1">&#39;frame-</span><span class="si">{band}</span><span class="s1">-</span><span class="si">{run:06d}</span><span class="s1">-</span><span class="si">{camcol}</span><span class="s1">-&#39;</span>
                          <span class="s1">&#39;</span><span class="si">{field:04d}</span><span class="s1">.fits.bz2&#39;</span><span class="p">)</span>
    <span class="n">SPECTRA_URL_SUFFIX</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{base}</span><span class="s1">/dr</span><span class="si">{dr}</span><span class="s1">/sdss/spectro/redux/&#39;</span>
                          <span class="s1">&#39;</span><span class="si">{run2d}</span><span class="s1">/spectra/</span><span class="si">{plate:0&gt;4d}</span><span class="s1">/&#39;</span>
                          <span class="s1">&#39;spec-</span><span class="si">{plate:0&gt;4d}</span><span class="s1">-</span><span class="si">{mjd}</span><span class="s1">-</span><span class="si">{fiber:04d}</span><span class="s1">.fits&#39;</span><span class="p">)</span>

    <span class="n">TEMPLATES_URL</span> <span class="o">=</span> <span class="s1">&#39;http://classic.sdss.org/dr7/algorithms/spectemplates/spDR2&#39;</span>
    <span class="c1"># Cross-correlation templates from DR-7 - no clear way to look this up via</span>
    <span class="c1"># queries so we just name them explicitly here</span>
    <span class="n">AVAILABLE_TEMPLATES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;star_O&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;star_OB&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;star_B&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                           <span class="s1">&#39;star_A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;star_FA&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;star_F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
                           <span class="s1">&#39;star_G&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;star_K&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;star_M1&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                           <span class="s1">&#39;star_M3&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;star_M5&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;star_M8&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                           <span class="s1">&#39;star_L1&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;star_wd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">],</span>
                           <span class="s1">&#39;star_carbon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span> <span class="s1">&#39;star_Ksubdwarf&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
                           <span class="s1">&#39;galaxy_early&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;galaxy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">],</span>
                           <span class="s1">&#39;galaxy_late&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;galaxy_lrg&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;qso&#39;</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span>
                           <span class="s1">&#39;qso_bal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span> <span class="s1">&#39;qso_bright&#39;</span><span class="p">:</span> <span class="mi">32</span>
                           <span class="p">}</span>

<div class="viewcode-block" id="SDSSClass.query_crossid_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.query_crossid_async">[docs]</a>
    <span class="k">def</span> <span class="nf">query_crossid_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">5.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                            <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">photoobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">specobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obj_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">spectro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query using the cross-identification web interface.</span>

<span class="sd">        This query returns the nearest `primary object`_.</span>

<span class="sd">        Note that there is a server-side limit of 3 arcmin on ``radius``.</span>

<span class="sd">        .. _`primary object`: https://www.sdss4.org/dr17/help/glossary/#surveyprimary</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : str or `astropy.coordinates` object or (list or `~astropy.table.Column`) of coordinates</span>
<span class="sd">            The target(s) around which to search. It may be specified as a</span>
<span class="sd">            string in which case it is resolved using online services or as</span>
<span class="sd">            the appropriate `astropy.coordinates` object. ICRS coordinates</span>
<span class="sd">            may also be entered as strings as specified in the</span>
<span class="sd">            `astropy.coordinates` module.</span>

<span class="sd">            Example:</span>
<span class="sd">            ra = np.array([220.064728084,220.064728467,220.06473483])</span>
<span class="sd">            dec = np.array([0.870131920218,0.87013210119,0.870138329659])</span>
<span class="sd">            coordinates = SkyCoord(ra, dec, frame=&#39;icrs&#39;, unit=&#39;deg&#39;)</span>
<span class="sd">        radius : str or `~astropy.units.Quantity` object or `~astropy.coordinates.Angle` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from</span>
<span class="sd">            `astropy.units` or `~astropy.coordinates.Angle` object from</span>
<span class="sd">            `astropy.coordinates` may also be used. Defaults to 5 arcsec.</span>
<span class="sd">            The maximum allowed value is 3 arcmin.</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        fields : list, optional</span>
<span class="sd">            SDSS PhotoObj or SpecObj quantities to return. If None, defaults</span>
<span class="sd">            to quantities required to find corresponding spectra and images</span>
<span class="sd">            of matched objects (e.g. plate, fiberID, mjd, etc.).</span>
<span class="sd">        photoobj_fields : list, optional</span>
<span class="sd">            PhotoObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        specobj_fields : list, optional</span>
<span class="sd">            SpecObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        obj_names : str, or list or `~astropy.table.Column`, optional</span>
<span class="sd">            Target names. If given, every coordinate should have a</span>
<span class="sd">            corresponding name, and it gets repeated in the query result.</span>
<span class="sd">            It generates unique object names by default.</span>
<span class="sd">        spectro : bool, optional</span>
<span class="sd">            Look for spectroscopic match in addition to photometric match? If</span>
<span class="sd">            True, objects will only count as a match if photometry *and*</span>
<span class="sd">            spectroscopy exist. If False, will look for photometric matches</span>
<span class="sd">            only.</span>
<span class="sd">        region : bool, optional</span>
<span class="sd">            Normally cross-id only returns the closest primary object.</span>
<span class="sd">            Setting this to ``True`` will return all objects.</span>
<span class="sd">        field_help: str or bool, optional</span>
<span class="sd">            Field name to check whether a valid PhotoObjAll or SpecObjAll</span>
<span class="sd">            field name. If `True` or it is an invalid field name all the valid</span>
<span class="sd">            field names are returned as a dict.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            If ``True`` use the request caching mechanism.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the ``radius`` keyword could not be parsed as an angle.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the ``radius`` exceeds 3 arcmin, or if the sizes of</span>
<span class="sd">            ``coordinates`` and ``obj_names`` do not match.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `~astropy.table.Table`</span>
<span class="sd">            The result of the query as a `~astropy.table.Table` object.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">Angle</span><span class="p">):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;radius should be either Quantity or &quot;</span>
                                <span class="s2">&quot;convertible to float.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_CROSSID_RADIUS</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;radius must be less than </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_CROSSID_RADIUS</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">commons</span><span class="o">.</span><span class="n">CoordClasses</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">isscalar</span><span class="p">)):</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordinates</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">obj_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;obj_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">))]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_names</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of coordinates and obj_names should &quot;</span>
                             <span class="s2">&quot;be equal&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;ra dec </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">data_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{ra}</span><span class="s1"> </span><span class="si">{dec}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># SDSS&#39;s own examples default to &#39;name&#39;.  &#39;obj_id&#39; is too easy to confuse with &#39;objID&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;name ra dec </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">data_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{obj}</span><span class="s1"> </span><span class="si">{ra}</span><span class="s1"> </span><span class="si">{dec}</span><span class="s1">&#39;</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">data_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                <span class="n">ra</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
                                                <span class="n">dec</span><span class="o">=</span><span class="n">coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">))])</span>

        <span class="c1"># firstcol is hardwired, as obj_names is always passed</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;upload&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;astroquery&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)}</span>

        <span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                                <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                                                <span class="n">spectro</span><span class="o">=</span><span class="n">spectro</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                                                <span class="n">photoobj_fields</span><span class="o">=</span><span class="n">photoobj_fields</span><span class="p">,</span>
                                                <span class="n">specobj_fields</span><span class="o">=</span><span class="n">specobj_fields</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                                <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_help</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span><span class="p">,</span> <span class="n">files</span>

        <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;firstcol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># First column is RA.</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;photoScope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;allObj&#39;</span>  <span class="c1"># All nearby objects, i.e. PhotoObjAll</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;firstcol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Skip one column, which contains the object name.</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;photoScope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;nearPrim&#39;</span>  <span class="c1"># Nearest primary object</span>
        <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;photoUpType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ra-dec&#39;</span>  <span class="c1"># Input data payload has RA, Dec coordinates</span>
        <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;searchType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;photo&#39;</span>

        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span><span class="p">,</span> <span class="n">files</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_crossid_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span>
                                 <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="SDSSClass.query_region_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.query_region_async">[docs]</a>
    <span class="k">def</span> <span class="nf">query_region_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                           <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">photoobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">specobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obj_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">spectro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to query a region around given coordinates. Either ``radius`` or</span>
<span class="sd">        ``width`` must be specified.</span>

<span class="sd">        When called with keyword ``radius``, a radial or &quot;cone&quot; search is</span>
<span class="sd">        performed, centered on each of the given coordinates. In this mode, internally,</span>
<span class="sd">        this function is equivalent to the object cross-ID (`query_crossid`),</span>
<span class="sd">        with slightly different parameters.  Note that in this mode there is a server-side</span>
<span class="sd">        limit of 3 arcmin on ``radius``.</span>

<span class="sd">        When called with keyword ``width``, and optionally a different ``height``,</span>
<span class="sd">        a rectangular search is performed, centered on each of the given</span>
<span class="sd">        coordinates. In this mode, internally, this function is equivalent to</span>
<span class="sd">        a general SQL query (`query_sql`). The shape of the rectangle is</span>
<span class="sd">        not corrected for declination (*i.e.* no :math:`\cos \delta` correction);</span>
<span class="sd">        conceptually, this means that the rectangle will become increasingly</span>
<span class="sd">        trapezoidal-shaped at high declination.</span>

<span class="sd">        In both radial and rectangular modes, this function returns all objects</span>
<span class="sd">        within the search area; this could potentially include duplicate observations</span>
<span class="sd">        of the same object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : str or `astropy.coordinates` object or (list or `~astropy.table.Column`) of coordinates</span>
<span class="sd">            The target(s) around which to search. It may be specified as a</span>
<span class="sd">            string in which case it is resolved using online services or as</span>
<span class="sd">            the appropriate `astropy.coordinates` object. ICRS coordinates</span>
<span class="sd">            may also be entered as strings as specified in the</span>
<span class="sd">            `astropy.coordinates` module.</span>

<span class="sd">            Example:</span>
<span class="sd">            ra = np.array([220.064728084,220.064728467,220.06473483])</span>
<span class="sd">            dec = np.array([0.870131920218,0.87013210119,0.870138329659])</span>
<span class="sd">            coordinates = SkyCoord(ra, dec, frame=&#39;icrs&#39;, unit=&#39;deg&#39;)</span>
<span class="sd">        radius : str or `~astropy.units.Quantity` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from</span>
<span class="sd">            `astropy.units` may also be used.</span>
<span class="sd">            The maximum allowed value is 3 arcmin.</span>
<span class="sd">        width : str or `~astropy.units.Quantity` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from</span>
<span class="sd">            `astropy.units` may also be used.</span>
<span class="sd">        height : str or `~astropy.units.Quantity` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from</span>
<span class="sd">            `astropy.units` may also be used. If not specified, it will be</span>
<span class="sd">            set to the same value as ``width``.</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        fields : list, optional</span>
<span class="sd">            SDSS PhotoObj or SpecObj quantities to return. If None, defaults</span>
<span class="sd">            to quantities required to find corresponding spectra and images</span>
<span class="sd">            of matched objects (e.g. plate, fiberID, mjd, etc.).</span>
<span class="sd">        photoobj_fields : list, optional</span>
<span class="sd">            PhotoObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        specobj_fields : list, optional</span>
<span class="sd">            SpecObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        obj_names : str, or list or `~astropy.table.Column`, optional</span>
<span class="sd">            Target names. If given, every coordinate should have a</span>
<span class="sd">            corresponding name, and it gets repeated in the query result.</span>
<span class="sd">        spectro : bool, optional</span>
<span class="sd">            Look for spectroscopic match in addition to photometric match? If</span>
<span class="sd">            True, objects will only count as a match if photometry *and*</span>
<span class="sd">            spectroscopy exist. If False, will look for photometric matches</span>
<span class="sd">            only.</span>
<span class="sd">        field_help: str or bool, optional</span>
<span class="sd">            Field name to check whether a valid PhotoObjAll or SpecObjAll</span>
<span class="sd">            field name. If `True` or it is an invalid field name all the valid</span>
<span class="sd">            field names are returned as a dict.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            If ``True`` use the request caching mechanism.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the ``radius``, ``width`` or ``height`` keywords could not be parsed as an angle.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If both ``radius`` and ``width`` are set (or neither),</span>
<span class="sd">            or if the ``radius`` exceeds 3 arcmin,</span>
<span class="sd">            or if the sizes of ``coordinates`` and ``obj_names`` do not match,</span>
<span class="sd">            or if the units of ``width`` or ``height`` could not be parsed.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; from astropy import coordinates as coords</span>
<span class="sd">        &gt;&gt;&gt; co = coords.SkyCoord(&#39;0h8m05.63s +14d50m23.3s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = SDSS.query_region(co)</span>
<span class="sd">        &gt;&gt;&gt; print(result[:5])</span>
<span class="sd">              ra           dec             objid        run  rerun camcol field</span>
<span class="sd">        ------------- ------------- ------------------- ---- ----- ------ -----</span>
<span class="sd">        2.02344282607 14.8398204075 1237653651835781245 1904   301      3   163</span>
<span class="sd">        2.02344283666 14.8398204143 1237653651835781244 1904   301      3   163</span>
<span class="sd">        2.02344596595 14.8398237229 1237652943176138867 1739   301      3   315</span>
<span class="sd">        2.02344596303 14.8398237521 1237652943176138868 1739   301      3   315</span>
<span class="sd">        2.02344772021 14.8398201105 1237653651835781243 1904   301      3   163</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `~astropy.table.Table`</span>
<span class="sd">            The result of the query as a `~astropy.table.Table` object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Allow field_help requests to pass without requiring a radius or width.</span>
        <span class="k">if</span> <span class="n">field_help</span> <span class="ow">and</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>

        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either radius or width must be specified!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either radius or width must be specified, not both!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_crossid_async</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                                              <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                                                              <span class="n">photoobj_fields</span><span class="o">=</span><span class="n">photoobj_fields</span><span class="p">,</span>
                                                              <span class="n">specobj_fields</span><span class="o">=</span><span class="n">specobj_fields</span><span class="p">,</span>
                                                              <span class="n">obj_names</span><span class="o">=</span><span class="n">obj_names</span><span class="p">,</span>
                                                              <span class="n">spectro</span><span class="o">=</span><span class="n">spectro</span><span class="p">,</span>
                                                              <span class="n">region</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                              <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                                              <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                              <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">width</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

            <span class="n">dummy_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                                  <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                                                  <span class="n">spectro</span><span class="o">=</span><span class="n">spectro</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                  <span class="n">photoobj_fields</span><span class="o">=</span><span class="n">photoobj_fields</span><span class="p">,</span>
                                                  <span class="n">specobj_fields</span><span class="o">=</span><span class="n">specobj_fields</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                                  <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>

            <span class="n">sql_query</span> <span class="o">=</span> <span class="n">dummy_payload</span><span class="p">[</span><span class="s1">&#39;uquery&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#upload u JOIN #x x ON x.up_id = u.up_id JOIN &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;SpecObjAll&#39;</span> <span class="ow">in</span> <span class="n">dummy_payload</span><span class="p">[</span><span class="s1">&#39;uquery&#39;</span><span class="p">]:</span>
                <span class="n">sql_query</span> <span class="o">=</span> <span class="n">sql_query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ON p.objID = x.objID &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; ORDER BY x.up_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sql_query</span> <span class="o">=</span> <span class="n">sql_query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; ON p.objID = x.objID ORDER BY x.up_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">commons</span><span class="o">.</span><span class="n">CoordClasses</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">isscalar</span><span class="p">)):</span>
                <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span><span class="n">coordinates</span><span class="p">]</span>

            <span class="n">rectangles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
                <span class="c1"># Query for a rectangle</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">commons</span><span class="o">.</span><span class="n">parse_coordinates</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="s1">&#39;fk5&#39;</span><span class="p">)</span>
                <span class="n">rectangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rectangle_sql</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">))</span>

            <span class="n">rect</span> <span class="o">=</span> <span class="s1">&#39; OR &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rectangles</span><span class="p">)</span>

            <span class="c1"># self._args_to_payload only returns a WHERE if e.g. plate, mjd, fiber</span>
            <span class="c1"># are set, which will not happen in this function.</span>
            <span class="n">sql_query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; WHERE (</span><span class="si">{</span><span class="n">rect</span><span class="si">}</span><span class="s1">)&#39;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_sql_async</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                        <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span>
                                        <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                                        <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                        <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_query_payload</span> <span class="ow">or</span> <span class="n">field_help</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_crossid_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span>
                                 <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="SDSSClass.query_specobj_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.query_specobj_async">[docs]</a>
    <span class="k">def</span> <span class="nf">query_specobj_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">plate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                            <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to query the SpecObjAll table with plate, mjd and fiberID values.</span>

<span class="sd">        At least one of ``plate``, ``mjd`` or ``fiberID`` parameters must be</span>
<span class="sd">        specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plate : integer, optional</span>
<span class="sd">            Plate number.</span>
<span class="sd">        mjd : integer, optional</span>
<span class="sd">            Modified Julian Date indicating the date a given piece of SDSS data</span>
<span class="sd">            was taken.</span>
<span class="sd">        fiberID : integer, optional</span>
<span class="sd">            Fiber number.</span>
<span class="sd">        fields : list, optional</span>
<span class="sd">            SDSS PhotoObj or SpecObj quantities to return. If None, defaults</span>
<span class="sd">            to quantities required to find corresponding spectra and images</span>
<span class="sd">            of matched objects (e.g. plate, fiberID, mjd, etc.).</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        field_help: str or bool, optional</span>
<span class="sd">            Field name to check whether a valid PhotoObjAll or SpecObjAll</span>
<span class="sd">            field name. If `True` or it is an invalid field name all the valid</span>
<span class="sd">            field names are returned as a dict.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            If ``True`` use the request caching mechanism.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; result = SDSS.query_specobj(plate=2340,</span>
<span class="sd">        ...     fields=[&#39;ra&#39;, &#39;dec&#39;,&#39;plate&#39;, &#39;mjd&#39;, &#39;fiberID&#39;, &#39;specobjid&#39;])</span>
<span class="sd">        &gt;&gt;&gt; print(result[:5])</span>
<span class="sd">              ra           dec      plate  mjd  fiberID      specobjid</span>
<span class="sd">        ------------- ------------- ----- ----- ------- -------------------</span>
<span class="sd">        49.2020613611 5.20883041368  2340 53733      60 2634622337315530752</span>
<span class="sd">        48.3745360119 5.26557511598  2340 53733     154 2634648175838783488</span>
<span class="sd">        47.1604269095 5.48241410994  2340 53733     332 2634697104106219520</span>
<span class="sd">        48.6634992214 6.69459110287  2340 53733     553 2634757852123654144</span>
<span class="sd">        48.0759195428 6.18757403485  2340 53733     506 2634744932862027776</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `~astropy.table.Table`</span>
<span class="sd">            The result of the query as an `~astropy.table.Table` object.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">plate</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mjd</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fiberID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify at least one of &#39;</span>
                             <span class="s1">&#39;`plate`, `mjd` or `fiberID`&#39;</span><span class="p">)</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="n">plate</span><span class="o">=</span><span class="n">plate</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="p">,</span>
                                                <span class="n">fiberID</span><span class="o">=</span><span class="n">fiberID</span><span class="p">,</span>
                                                <span class="n">specobj_fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                                                <span class="n">spectro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                                <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_query_payload</span> <span class="ow">or</span> <span class="n">field_help</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="SDSSClass.query_photoobj_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.query_photoobj_async">[docs]</a>
    <span class="k">def</span> <span class="nf">query_photoobj_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="mi">301</span><span class="p">,</span> <span class="n">camcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                             <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">field_help</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to query the PhotoObjAll table with run, rerun, camcol and field</span>
<span class="sd">        values.</span>

<span class="sd">        At least one of ``run``, ``camcol`` or ``field`` parameters must be</span>
<span class="sd">        specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        run : integer, optional</span>
<span class="sd">            Length of a strip observed in a single continuous image observing</span>
<span class="sd">            scan.</span>
<span class="sd">        rerun : integer, optional</span>
<span class="sd">            Reprocessing of an imaging run. Defaults to 301 which is the most</span>
<span class="sd">            recent rerun.</span>
<span class="sd">        camcol : integer, optional</span>
<span class="sd">            Output of one camera column of CCDs.</span>
<span class="sd">        field : integer, optional</span>
<span class="sd">            Part of a camcol of size 2048 by 1489 pixels.</span>
<span class="sd">        fields : list, optional</span>
<span class="sd">            SDSS PhotoObj or SpecObj quantities to return. If None, defaults</span>
<span class="sd">            to quantities required to find corresponding spectra and images</span>
<span class="sd">            of matched objects (e.g. plate, fiberID, mjd, etc.).</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        field_help: str or bool, optional</span>
<span class="sd">            Field name to check whether a valid PhotoObjAll or SpecObjAll</span>
<span class="sd">            field name. If `True` or it is an invalid field name all the valid</span>
<span class="sd">            field names are returned as a dict.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            If ``True`` use the request caching mechanism.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; result = SDSS.query_photoobj(run=5714, camcol=6)</span>
<span class="sd">        &gt;&gt;&gt; print(result[:5])</span>
<span class="sd">              ra           dec             objid        run  rerun camcol field</span>
<span class="sd">        ------------- ------------- ------------------- ---- ----- ------ -----</span>
<span class="sd">        30.4644529079 7.86460794626 1237670017266024498 5714   301      6    75</span>
<span class="sd">        38.7635496073 7.47083098197 1237670017269628978 5714   301      6   130</span>
<span class="sd">        22.2574304026 8.43175488904 1237670017262485671 5714   301      6    21</span>
<span class="sd">        23.3724928784 8.32576993103 1237670017262944491 5714   301      6    28</span>
<span class="sd">        25.4801226435 8.27642390025 1237670017263927330 5714   301      6    43</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `~astropy.table.Table`</span>
<span class="sd">            The result of the query as a `~astropy.table.Table` object.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">camcol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify at least one of &#39;</span>
                             <span class="s1">&#39;`run`, `camcol` or `field`&#39;</span><span class="p">)</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="n">run</span><span class="o">=</span><span class="n">run</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="n">rerun</span><span class="p">,</span>
                                                <span class="n">camcol</span><span class="o">=</span><span class="n">camcol</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                                                <span class="n">photoobj_fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
                                                <span class="n">spectro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                <span class="n">field_help</span><span class="o">=</span><span class="n">field_help</span><span class="p">,</span>
                                                <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_query_payload</span> <span class="ow">or</span> <span class="n">field_help</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>


    <span class="k">def</span> <span class="nf">__sanitize_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove comments and newlines from SQL statement.&quot;&quot;&quot;</span>
        <span class="n">fsql</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">fsql</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fsql</span>

<div class="viewcode-block" id="SDSSClass.query_sql_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.query_sql_async">[docs]</a>
    <span class="k">def</span> <span class="nf">query_sql_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql_query</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                        <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span>
                        <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the SDSS database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sql_query : str</span>
<span class="sd">            An SQL query</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            If ``True`` use the request caching mechanism.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; query = &quot;select top 10 \</span>
<span class="sd">                       z, ra, dec, bestObjID \</span>
<span class="sd">                     from \</span>
<span class="sd">                       specObj \</span>
<span class="sd">                     where \</span>
<span class="sd">                       class = &#39;galaxy&#39; \</span>
<span class="sd">                       and z &gt; 0.3 \</span>
<span class="sd">                       and zWarning = 0&quot;</span>
<span class="sd">        &gt;&gt;&gt; res = SDSS.query_sql(query)</span>
<span class="sd">        &gt;&gt;&gt; print(res[:5])</span>
<span class="sd">            z         ra       dec         bestObjID</span>
<span class="sd">        --------- --------- --------- -------------------</span>
<span class="sd">        0.3000011 16.411075 4.1197892 1237678660894327022</span>
<span class="sd">        0.3000012 49.459411  0.847754 1237660241924063461</span>
<span class="sd">        0.3000027 156.25024 7.6586271 1237658425162858683</span>
<span class="sd">        0.3000027 256.99461 25.566255 1237661387086693265</span>
<span class="sd">         0.300003 175.65125  34.37548 1237665128003731630</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : `~astropy.table.Table`</span>
<span class="sd">            The result of the query as a `~astropy.table.Table` object.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">request_payload</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sanitize_query</span><span class="p">(</span><span class="n">sql_query</span><span class="p">),</span>
                               <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_release</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;searchtool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SQL&#39;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;get_query_payload&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field_help&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="SDSSClass.get_spectra_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_spectra_async">[docs]</a>
    <span class="k">def</span> <span class="nf">get_spectra_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span>
                          <span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download spectrum from SDSS.</span>

<span class="sd">        The query can be made with one the following groups of parameters</span>
<span class="sd">        (whichever comes first is used):</span>

<span class="sd">        - ``matches`` (result of a call to `query_region`);</span>
<span class="sd">        - ``coordinates``, ``radius``;</span>
<span class="sd">        - ``plate``, ``mjd``, ``fiberID``.</span>

<span class="sd">        See below for examples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : str or `astropy.coordinates` object</span>
<span class="sd">            The target around which to search. It may be specified as a string</span>
<span class="sd">            in which case it is resolved using online services or as the</span>
<span class="sd">            appropriate `astropy.coordinates` object. ICRS coordinates may also</span>
<span class="sd">            be entered as strings as specified in the `astropy.coordinates`</span>
<span class="sd">            module.</span>
<span class="sd">        radius : str or `~astropy.units.Quantity` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from `astropy.units`</span>
<span class="sd">            may also be used. Defaults to 2 arcsec.</span>
<span class="sd">        matches : `~astropy.table.Table`</span>
<span class="sd">            Result of `query_region`.</span>
<span class="sd">        plate : integer, optional</span>
<span class="sd">            Plate number.</span>
<span class="sd">        fiberID : integer, optional</span>
<span class="sd">            Fiber number.</span>
<span class="sd">        mjd : integer, optional</span>
<span class="sd">            Modified Julian Date indicating the date a given piece of SDSS data</span>
<span class="sd">            was taken.</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use. With the default server, this</span>
<span class="sd">            only supports DR8 or later.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Cache the spectra using astropy&#39;s caching system</span>
<span class="sd">        show_progress : bool, optional</span>
<span class="sd">            If False, do not display download progress.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : list</span>
<span class="sd">            A list of context-managers that yield readable file-like objects.</span>
<span class="sd">            The function returns the spectra for only one of ``matches``, or</span>
<span class="sd">            ``coordinates`` and ``radius``, or ``plate``, ``mjd`` and</span>
<span class="sd">            ``fiberID``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Using results from a call to `query_region`:</span>

<span class="sd">        &gt;&gt;&gt; from astropy import coordinates as coords</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; co = coords.SkyCoord(&#39;0h8m05.63s +14d50m23.3s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = SDSS.query_region(co, spectro=True)</span>
<span class="sd">        &gt;&gt;&gt; spec = SDSS.get_spectra(matches=result)</span>

<span class="sd">        Using coordinates directly:</span>

<span class="sd">        &gt;&gt;&gt; spec = SDSS.get_spectra(co)</span>

<span class="sd">        Fetch the spectra from all fibers on plate 751 with mjd 52251:</span>

<span class="sd">        &gt;&gt;&gt; specs = SDSS.get_spectra(plate=751, mjd=52251)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_specobj</span><span class="p">(</span><span class="n">plate</span><span class="o">=</span><span class="n">plate</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="n">fiberID</span><span class="p">,</span>
                                             <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">,</span> <span class="s1">&#39;plate&#39;</span><span class="p">,</span> <span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="s1">&#39;fiberID&#39;</span><span class="p">],</span>
                                             <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                             <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_crossid</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                             <span class="n">specobj_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">,</span> <span class="s1">&#39;plate&#39;</span><span class="p">,</span> <span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="s1">&#39;fiberID&#39;</span><span class="p">],</span>
                                             <span class="n">spectro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                             <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">matches</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Query returned no results.&quot;</span><span class="p">,</span> <span class="n">NoResultsWarning</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;matches&#39; must be an astropy Table.&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">linkstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECTRA_URL_SUFFIX</span>
            <span class="c1"># _parse_result returns bytes (requiring a decode) for</span>
            <span class="c1"># - instruments</span>
            <span class="c1"># - run2d sometimes (#739)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">run2d</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">run2d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">run2d</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;run2d&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data_release</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="ow">and</span> <span class="n">run2d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;26&#39;</span><span class="p">,</span> <span class="s1">&#39;103&#39;</span><span class="p">,</span> <span class="s1">&#39;104&#39;</span><span class="p">):</span>
                <span class="n">linkstr</span> <span class="o">=</span> <span class="n">linkstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/spectra/&#39;</span><span class="p">,</span> <span class="s1">&#39;/spectra/full/&#39;</span><span class="p">)</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">linkstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">base</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">sas_baseurl</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span>
                <span class="n">run2d</span><span class="o">=</span><span class="n">run2d</span><span class="p">,</span> <span class="n">plate</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;plate&#39;</span><span class="p">],</span>
                <span class="n">fiber</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;fiberID&#39;</span><span class="p">],</span> <span class="n">mjd</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">])</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commons</span><span class="o">.</span><span class="n">FileContainer</span><span class="p">(</span><span class="n">link</span><span class="p">,</span>
                                                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span>
                                                 <span class="n">remote_timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                                 <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="SDSSClass.get_spectra">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_spectra">[docs]</a>
    <span class="nd">@prepend_docstr_nosections</span><span class="p">(</span><span class="n">get_spectra_async</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span>
                    <span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : List of `~astropy.io.fits.HDUList` objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">readable_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectra_async</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                               <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">matches</span><span class="o">=</span><span class="n">matches</span><span class="p">,</span>
                                               <span class="n">plate</span><span class="o">=</span><span class="n">plate</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="n">fiberID</span><span class="p">,</span>
                                               <span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                               <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                               <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span>
                                               <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                                               <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">readable_objs</span>

        <span class="k">if</span> <span class="n">readable_objs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readable_objs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">readable_objs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">get_fits</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">readable_objs</span><span class="p">]</span></div>


<div class="viewcode-block" id="SDSSClass.get_images_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_images_async">[docs]</a>
    <span class="k">def</span> <span class="nf">get_images_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span>
                         <span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="mi">301</span><span class="p">,</span> <span class="n">camcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                         <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span>
                         <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download an image from SDSS.</span>

<span class="sd">        Querying SDSS for images will return the entire plate. For subsequent</span>
<span class="sd">        analyses of individual objects</span>

<span class="sd">        The query can be made with one the following groups of parameters</span>
<span class="sd">        (whichever comes first is used):</span>

<span class="sd">        - ``matches`` (result of a call to `query_region`);</span>
<span class="sd">        - ``coordinates``, ``radius``;</span>
<span class="sd">        - ``run``, ``rerun``, ``camcol``, ``field``.</span>

<span class="sd">        See below for examples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : str or `astropy.coordinates` object</span>
<span class="sd">            The target around which to search. It may be specified as a string</span>
<span class="sd">            in which case it is resolved using online services or as the</span>
<span class="sd">            appropriate `astropy.coordinates` object. ICRS coordinates may also</span>
<span class="sd">            be entered as strings as specified in the `astropy.coordinates`</span>
<span class="sd">            module.</span>
<span class="sd">        radius : str or `~astropy.units.Quantity` object, optional</span>
<span class="sd">            The string must be parsable by `~astropy.coordinates.Angle`. The</span>
<span class="sd">            appropriate `~astropy.units.Quantity` object from</span>
<span class="sd">            `astropy.units` may also be used. Defaults to 2 arcsec.</span>
<span class="sd">        matches : `~astropy.table.Table`</span>
<span class="sd">            Result of `query_region`.</span>
<span class="sd">        run : integer, optional</span>
<span class="sd">            Length of a strip observed in a single continuous image observing</span>
<span class="sd">            scan.</span>
<span class="sd">        rerun : integer, optional</span>
<span class="sd">            Reprocessing of an imaging run. Defaults to 301 which is the most</span>
<span class="sd">            recent rerun.</span>
<span class="sd">        camcol : integer, optional</span>
<span class="sd">            Output of one camera column of CCDs.</span>
<span class="sd">        field : integer, optional</span>
<span class="sd">            Part of a camcol of size 2048 by 1489 pixels.</span>
<span class="sd">        band : str or list</span>
<span class="sd">            Could be individual band, or list of bands.</span>
<span class="sd">            Options: ``&#39;u&#39;``, ``&#39;g&#39;``, ``&#39;r&#39;``, ``&#39;i&#39;``, or ``&#39;z&#39;``.</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, this will return the data the query would have sent out,</span>
<span class="sd">            but does not actually do the query.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Cache the images using astropy&#39;s caching system</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>
<span class="sd">        show_progress : bool, optional</span>
<span class="sd">            If False, do not display download progress.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : List of `~astropy.io.fits.HDUList` objects.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Using results from a call to `query_region`:</span>

<span class="sd">        &gt;&gt;&gt; from astropy import coordinates as coords</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.sdss import SDSS</span>
<span class="sd">        &gt;&gt;&gt; co = coords.SkyCoord(&#39;0h8m05.63s +14d50m23.3s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = SDSS.query_region(co)</span>
<span class="sd">        &gt;&gt;&gt; imgs = SDSS.get_images(matches=result)</span>

<span class="sd">        Using coordinates directly:</span>

<span class="sd">        &gt;&gt;&gt; imgs = SDSS.get_images(co)</span>

<span class="sd">        Fetch the images from all runs with camcol 3 and field 164:</span>

<span class="sd">        &gt;&gt;&gt; imgs = SDSS.get_images(camcol=3, field=164)</span>

<span class="sd">        Fetch only images from run 1904, camcol 3 and field 164:</span>

<span class="sd">        &gt;&gt;&gt; imgs = SDSS.get_images(run=1904, camcol=3, field=164)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_photoobj</span><span class="p">(</span><span class="n">run</span><span class="o">=</span><span class="n">run</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="n">rerun</span><span class="p">,</span>
                                              <span class="n">camcol</span><span class="o">=</span><span class="n">camcol</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                                              <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;rerun&#39;</span><span class="p">,</span> <span class="s1">&#39;camcol&#39;</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">],</span>
                                              <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                              <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_crossid</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                             <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;rerun&#39;</span><span class="p">,</span> <span class="s1">&#39;camcol&#39;</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">],</span>
                                             <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                             <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">matches</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Query returned no results.&quot;</span><span class="p">,</span> <span class="n">NoResultsWarning</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;matches&#39; must be an astropy Table&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="c1"># Download and read in image data</span>
                <span class="n">linkstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMAGING_URL_SUFFIX</span>
                <span class="n">instrument</span> <span class="o">=</span> <span class="s1">&#39;boss&#39;</span>
                <span class="k">if</span> <span class="n">data_release</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
                    <span class="n">instrument</span> <span class="o">=</span> <span class="s1">&#39;eboss&#39;</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">linkstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">sas_baseurl</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;run&#39;</span><span class="p">],</span>
                                      <span class="n">dr</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="n">instrument</span><span class="p">,</span>
                                      <span class="n">rerun</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rerun&#39;</span><span class="p">],</span> <span class="n">camcol</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;camcol&#39;</span><span class="p">],</span>
                                      <span class="n">field</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">],</span> <span class="n">band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>

                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commons</span><span class="o">.</span><span class="n">FileContainer</span><span class="p">(</span>
                    <span class="n">link</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">remote_timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="SDSSClass.get_images">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_images">[docs]</a>
    <span class="nd">@prepend_docstr_nosections</span><span class="p">(</span><span class="n">get_images_async</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">,</span>
                   <span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="mi">301</span><span class="p">,</span> <span class="n">camcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">,</span>
                   <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : List of `~astropy.io.fits.HDUList` objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">readable_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_images_async</span><span class="p">(</span><span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>
                                              <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
                                              <span class="n">matches</span><span class="o">=</span><span class="n">matches</span><span class="p">,</span>
                                              <span class="n">run</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
                                              <span class="n">rerun</span><span class="o">=</span><span class="n">rerun</span><span class="p">,</span>
                                              <span class="n">camcol</span><span class="o">=</span><span class="n">camcol</span><span class="p">,</span>
                                              <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                                              <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span>
                                              <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                              <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                                              <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span>
                                              <span class="n">data_release</span><span class="o">=</span><span class="n">data_release</span><span class="p">,</span>
                                              <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">readable_objs</span>

        <span class="k">if</span> <span class="n">readable_objs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">readable_objs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">readable_objs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">get_fits</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">readable_objs</span><span class="p">]</span></div>


<div class="viewcode-block" id="SDSSClass.get_spectral_template_async">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_spectral_template_async">[docs]</a>
    <span class="k">def</span> <span class="nf">get_spectral_template_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;qso&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                                    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download spectral templates from SDSS DR-2.</span>

<span class="sd">        Location: http://classic.sdss.org/dr7/algorithms/spectemplates/</span>

<span class="sd">        There 32 spectral templates available from DR-2, from stellar spectra,</span>
<span class="sd">        to galaxies, to quasars. To see the available templates, do:</span>

<span class="sd">            from astroquery.sdss import SDSS</span>
<span class="sd">            print SDSS.AVAILABLE_TEMPLATES</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kind : str or list</span>
<span class="sd">            Which spectral template to download? Options are stored in the</span>
<span class="sd">            dictionary astroquery.sdss.SDSS.AVAILABLE_TEMPLATES</span>
<span class="sd">        timeout : float, optional</span>
<span class="sd">            Time limit (in seconds) for establishing successful connection with</span>
<span class="sd">            remote server.  Defaults to `SDSSClass.TIMEOUT`.</span>
<span class="sd">        show_progress : bool, optional</span>
<span class="sd">            If False, do not display download progress.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; qso = SDSS.get_spectral_template(kind=&#39;qso&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Astar = SDSS.get_spectral_template(kind=&#39;star_A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; Fstar = SDSS.get_spectral_template(kind=&#39;star_F&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : List of `~astropy.io.fits.HDUList` objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">33</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AVAILABLE_TEMPLATES</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">indices</span><span class="p">]</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">link</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">.fit&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TEMPLATES_URL</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commons</span><span class="o">.</span><span class="n">FileContainer</span><span class="p">(</span><span class="n">link</span><span class="p">,</span>
                                                 <span class="n">remote_timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                                 <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span>
                                                 <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span></div>


<div class="viewcode-block" id="SDSSClass.get_spectral_template">
<a class="viewcode-back" href="../../../api/astroquery.sdss.SDSSClass.html#astroquery.sdss.SDSSClass.get_spectral_template">[docs]</a>
    <span class="nd">@prepend_docstr_nosections</span><span class="p">(</span><span class="n">get_spectral_template_async</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_spectral_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;qso&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span>
                              <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : List of `~astropy.io.fits.HDUList` objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">readable_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectral_template_async</span><span class="p">(</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">readable_objs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">get_fits</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">readable_objs</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">_parse_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the result and return either a `~astropy.table.Table` or</span>
<span class="sd">        `None` if no matches were found.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        response : `requests.Response`</span>
<span class="sd">            Result of requests -&gt; np.atleast_1d.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            Not currently used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : `~astropy.table.Table`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;error_message&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RemoteServiceError</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="c1"># Capturing the warning and converting the objid column to int64 is necessary for consistency as</span>
            <span class="c1"># it was convereted to string on systems with defaul integer int32 due to an overflow.</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">AstropyWarning</span><span class="p">,</span>
                                        <span class="n">message</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;OverflowError converting to IntType in column.*&#39;</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.csv&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">id_column</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;objid&#39;</span><span class="p">,</span> <span class="s1">&#39;specobjid&#39;</span><span class="p">,</span> <span class="s1">&#39;objID&#39;</span><span class="p">,</span> <span class="s1">&#39;specobjID&#39;</span><span class="p">,</span> <span class="s1">&#39;specObjID&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">id_column</span> <span class="ow">in</span> <span class="n">arr</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">arr</span><span class="p">[</span><span class="n">id_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">id_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">_args_to_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spectro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">plate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fiberID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">rerun</span><span class="o">=</span><span class="mi">301</span><span class="p">,</span> <span class="n">camcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">photoobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">specobj_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">field_help</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">data_release</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">default_release</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the SQL query from the arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coordinates : str or `astropy.coordinates` object or (list or `~astropy.table.Column`) or coordinates</span>
<span class="sd">            The target around which to search. It may be specified as a string</span>
<span class="sd">            in which case it is resolved using online services or as the</span>
<span class="sd">            appropriate `astropy.coordinates` object. ICRS coordinates may also</span>
<span class="sd">            be entered as strings as specified in the `astropy.coordinates`</span>
<span class="sd">            module.</span>
<span class="sd">        fields : list, optional</span>
<span class="sd">            SDSS PhotoObj or SpecObj quantities to return. If None, defaults</span>
<span class="sd">            to quantities required to find corresponding spectra and images</span>
<span class="sd">            of matched objects (e.g. plate, fiberID, mjd, etc.).</span>
<span class="sd">        spectro : bool, optional</span>
<span class="sd">            Look for spectroscopic match in addition to photometric match? If</span>
<span class="sd">            True, objects will only count as a match if photometry *and*</span>
<span class="sd">            spectroscopy exist. If False, will look for photometric matches</span>
<span class="sd">            only. If ``spectro`` is True, it is possible to let coordinates</span>
<span class="sd">            undefined and set at least one of ``plate``, ``mjd`` or ``fiberID``</span>
<span class="sd">            to search using these fields.</span>
<span class="sd">        region : bool, optional</span>
<span class="sd">            Used internally to distinguish certain types of queries.</span>
<span class="sd">        plate : integer, optional</span>
<span class="sd">            Plate number.</span>
<span class="sd">        mjd : integer, optional</span>
<span class="sd">            Modified Julian Date indicating the date a given piece of SDSS data</span>
<span class="sd">            was taken.</span>
<span class="sd">        fiberID : integer, optional</span>
<span class="sd">            Fiber number.</span>
<span class="sd">        run : integer, optional</span>
<span class="sd">            Length of a strip observed in a single continuous image observing</span>
<span class="sd">            scan.</span>
<span class="sd">        rerun : integer, optional</span>
<span class="sd">            Reprocessing of an imaging run. Defaults to 301 which is the most</span>
<span class="sd">            recent rerun.</span>
<span class="sd">        camcol : integer, optional</span>
<span class="sd">            Output of one camera column of CCDs.</span>
<span class="sd">        field : integer, optional</span>
<span class="sd">            Part of a camcol of size 2048 by 1489 pixels.</span>
<span class="sd">        photoobj_fields: list, optional</span>
<span class="sd">            PhotoObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        specobj_fields: list, optional</span>
<span class="sd">            SpecObj quantities to return. If photoobj_fields is None and</span>
<span class="sd">            specobj_fields is None then the value of fields is used</span>
<span class="sd">        field_help: str or bool, optional</span>
<span class="sd">            Field name to check whether it is a valid PhotoObjAll or SpecObjAll</span>
<span class="sd">            field name. If `True` or it is an invalid field name all the valid</span>
<span class="sd">            field names are returned as a dict.</span>
<span class="sd">        data_release : int, optional</span>
<span class="sd">            The data release of the SDSS to use.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        request_payload : dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_url</span><span class="p">(</span><span class="n">data_release</span><span class="p">)</span>
        <span class="c1"># TODO: replace this with something cleaner below</span>
        <span class="n">photoobj_all</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;PhotoObjAll&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="n">specobj_all</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;SpecObjAll&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">field_help</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_help</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">field_help</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">field_help</span> <span class="ow">in</span> <span class="n">photoobj_all</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_help</span><span class="si">}</span><span class="s2"> is a valid &#39;photoobj_field&#39;&quot;</span><span class="p">)</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">field_help</span> <span class="ow">in</span> <span class="n">specobj_all</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_help</span><span class="si">}</span><span class="s2"> is a valid &#39;specobj_field&#39;&quot;</span><span class="p">)</span>
                    <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field_help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_help</span><span class="si">}</span><span class="s2"> isn&#39;t a valid &#39;photobj_field&#39; or &quot;</span>
                                  <span class="s2">&quot;&#39;specobj_field&#39; field, valid fields are &quot;</span>
                                  <span class="s2">&quot;returned.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;photoobj_all&#39;</span><span class="p">:</span> <span class="n">photoobj_all</span><span class="p">,</span>
                        <span class="s1">&#39;specobj_all&#39;</span><span class="p">:</span> <span class="n">specobj_all</span><span class="p">}</span>

        <span class="c1"># Construct SQL query</span>
        <span class="n">q_select</span> <span class="o">=</span> <span class="s1">&#39;SELECT DISTINCT &#39;</span>
        <span class="n">crossid</span> <span class="o">=</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">region</span>  <span class="c1"># crossid queries have different default fields</span>
        <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q_select</span> <span class="o">=</span> <span class="s1">&#39;SELECT</span><span class="se">\r\n</span><span class="s1">&#39;</span>  <span class="c1"># Older versions expect the CRLF to be there.</span>
        <span class="n">q_select_field</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fields_spectro</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">photoobj_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">specobj_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Fields to return</span>
            <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">crossid</span><span class="p">:</span>
                    <span class="n">photoobj_fields</span> <span class="o">=</span> <span class="n">crossid_defs</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">photoobj_fields</span> <span class="o">=</span> <span class="n">photoobj_defs</span>
                <span class="k">if</span> <span class="n">spectro</span><span class="p">:</span>
                    <span class="n">specobj_fields</span> <span class="o">=</span> <span class="n">specobj_defs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sql_field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">sql_field</span> <span class="ow">in</span> <span class="n">photoobj_all</span>
                            <span class="ow">or</span> <span class="n">sql_field</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">photoobj_all</span><span class="p">):</span>
                        <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p.</span><span class="si">{</span><span class="n">sql_field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">sql_field</span> <span class="ow">in</span> <span class="n">specobj_all</span>
                          <span class="ow">or</span> <span class="n">sql_field</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">specobj_all</span><span class="p">):</span>
                        <span class="n">fields_spectro</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s.</span><span class="si">{</span><span class="n">sql_field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">photoobj_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sql_field</span> <span class="ow">in</span> <span class="n">photoobj_fields</span><span class="p">:</span>
                <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p.</span><span class="si">{</span><span class="n">sql_field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">specobj_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sql_field</span> <span class="ow">in</span> <span class="n">specobj_fields</span><span class="p">:</span>
                <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s.</span><span class="si">{</span><span class="n">sql_field</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">crossid</span> <span class="ow">and</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;s.SpecObjID AS obj_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crossid</span><span class="p">:</span>
            <span class="n">q_select_field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;dbo.fPhotoTypeN(p.type) AS type&#39;</span><span class="p">)</span>
        <span class="n">q_select</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">q_select_field</span><span class="p">)</span>

        <span class="n">q_from</span> <span class="o">=</span> <span class="s1">&#39;FROM PhotoObjAll AS p&#39;</span>
        <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q_from</span> <span class="o">=</span> <span class="s1">&#39;FROM #upload u JOIN #x x ON x.up_id = u.up_id JOIN PhotoObjAll AS p ON p.objID = x.objID&#39;</span>
        <span class="k">if</span> <span class="n">spectro</span> <span class="ow">or</span> <span class="n">specobj_fields</span> <span class="ow">or</span> <span class="n">fields_spectro</span><span class="p">:</span>
            <span class="n">q_from</span> <span class="o">+=</span> <span class="s1">&#39; JOIN SpecObjAll AS s ON p.objID = s.bestObjID&#39;</span>

        <span class="n">q_where</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q_where</span> <span class="o">=</span> <span class="s1">&#39;ORDER BY x.up_id&#39;</span>
        <span class="k">elif</span> <span class="n">spectro</span><span class="p">:</span>
            <span class="c1"># Spectra: query for specified plate, mjd, fiberid</span>
            <span class="n">s_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s.</span><span class="si">%s</span><span class="s1">=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span>
                        <span class="p">[(</span><span class="s1">&#39;plate&#39;</span><span class="p">,</span> <span class="n">plate</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;mjd&#39;</span><span class="p">,</span> <span class="n">mjd</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fiberid&#39;</span><span class="p">,</span> <span class="n">fiberID</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">s_fields</span><span class="p">:</span>
                <span class="n">q_where</span> <span class="o">=</span> <span class="s1">&#39;WHERE (&#39;</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s_fields</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">elif</span> <span class="n">run</span> <span class="ow">or</span> <span class="n">camcol</span> <span class="ow">or</span> <span class="n">field</span><span class="p">:</span>
            <span class="c1"># Imaging: query for specified run, rerun, camcol, field</span>
            <span class="n">p_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p.</span><span class="si">%s</span><span class="s1">=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span>
                        <span class="p">[(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;camcol&#39;</span><span class="p">,</span> <span class="n">camcol</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">p_fields</span><span class="p">:</span>
                <span class="n">p_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;p.rerun=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rerun</span><span class="p">)</span>
                <span class="n">q_where</span> <span class="o">=</span> <span class="s1">&#39;WHERE (&#39;</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_fields</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">q_where</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spectro</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify at least one of `coordinates`, &#39;</span>
                                 <span class="s1">&#39;`plate`, `mjd` or `fiberID`&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;must specify at least one of `coordinates`, &#39;</span>
                                 <span class="s1">&#39;`run`, `camcol` or `field`&#39;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">q_select</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q_from</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q_where</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># In DR 8 &amp; DR9 the format parameter is case-sensitive, but in later</span>
        <span class="c1"># releases that does not appear to be the case.  In principle &#39;csv&#39;</span>
        <span class="c1"># should work for all.</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;uquery&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sql</span>
            <span class="k">if</span> <span class="n">data_release</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;searchtool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CrossID&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sql</span>
            <span class="k">if</span> <span class="n">data_release</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
                <span class="n">request_payload</span><span class="p">[</span><span class="s1">&#39;searchtool&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SQL&#39;</span>

        <span class="k">return</span> <span class="n">request_payload</span>

    <span class="k">def</span> <span class="nf">_get_query_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_release</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate URL for generic SQL queries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_release</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QUERY_URL_SUFFIX_DR_OLD</span>
        <span class="k">elif</span> <span class="n">data_release</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QUERY_URL_SUFFIX_DR_10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QUERY_URL_SUFFIX_DR_NEW</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">skyserver_baseurl</span> <span class="o">+</span> <span class="n">suffix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dr</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">_get_crossid_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_release</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate URL for CrossID queries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_release</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XID_URL_SUFFIX_OLD</span>
        <span class="k">elif</span> <span class="n">data_release</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XID_URL_SUFFIX_DR_10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XID_URL_SUFFIX_NEW</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">skyserver_baseurl</span> <span class="o">+</span> <span class="n">suffix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dr</span><span class="o">=</span><span class="n">data_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">_rectangle_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cosdec</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate SQL for a rectangular query centered on ``ra``, ``dec``.</span>

<span class="sd">        This assumes that RA is defined on the range ``[0, 360)``, and Dec on</span>
<span class="sd">        ``[-90, 90]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ra : float</span>
<span class="sd">            Right Ascension in degrees.</span>
<span class="sd">        dec : float</span>
<span class="sd">            Declination in degrees.</span>
<span class="sd">        width : float</span>
<span class="sd">            Width of rectangle in degrees.</span>
<span class="sd">        height : float, optional</span>
<span class="sd">            Height of rectangle in degrees. If not specified, ``width`` is used.</span>
<span class="sd">        cosdec : bool, optional</span>
<span class="sd">            If ``True`` apply ``cos(dec)`` correction to the rectangle.</span>
<span class="sd">            Otherwise, rectangles become increasingly triangle-like</span>
<span class="sd">            near the poles.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`str`</span>
<span class="sd">            A string defining the rectangle in SQL notation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">width</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">width</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">height</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="n">dec</span> <span class="o">-</span> <span class="n">dd</span>
        <span class="k">if</span> <span class="n">d0</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">d0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">dec</span> <span class="o">+</span> <span class="n">dd</span>
        <span class="k">if</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="mf">90.0</span><span class="p">:</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="mf">90.0</span>
        <span class="n">ra_wrap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">-</span> <span class="n">dr</span>
        <span class="k">if</span> <span class="n">r0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ra_wrap</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">r0</span> <span class="o">+=</span> <span class="mf">360.0</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">+</span> <span class="n">dr</span>
        <span class="k">if</span> <span class="n">r1</span> <span class="o">&gt;</span> <span class="mf">360.0</span><span class="p">:</span>
            <span class="n">ra_wrap</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">r1</span> <span class="o">-=</span> <span class="mf">360.0</span>
        <span class="c1"># BETWEEN is inclusive, so it is equivalent to the &lt;=, &gt;= operators.</span>
        <span class="k">if</span> <span class="n">ra_wrap</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(((p.ra &gt;= </span><span class="si">{</span><span class="n">r0</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">) OR (p.ra &lt;= </span><span class="si">{</span><span class="n">r1</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">))&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((p.ra BETWEEN </span><span class="si">{</span><span class="n">r0</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> AND </span><span class="si">{</span><span class="n">r1</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">sql</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; AND (p.dec BETWEEN </span><span class="si">{</span><span class="n">d0</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2"> AND </span><span class="si">{</span><span class="n">d1</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">))&quot;</span></div>



<span class="n">SDSS</span> <span class="o">=</span> <span class="n">SDSSClass</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, The Astroquery Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 11 Dec 2023. <br/>
  </p>
</footer>
  </body>
</html>