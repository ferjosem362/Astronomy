<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astroquery.hips2fits.core &#8212; astroquery v0.4.7.dev9024</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-astropy.css?v=9d21690f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    
    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=4195d067"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">astro</span><span id="logotext2">query</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">astroquery v0.4.7.dev9024</a>
	 &#187;
      </li>
      <li><a href="../../index.html" >Module code</a> &#187;</li>
      <li><a href="../hips2fits.html" accesskey="U">astroquery.hips2fits</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astroquery.hips2fits.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*</span>

<span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">astropy.utils.exceptions</span> <span class="kn">import</span> <span class="n">AstropyUserWarning</span>

<span class="kn">from</span> <span class="nn">..query</span> <span class="kn">import</span> <span class="n">BaseQuery</span>
<span class="kn">from</span> <span class="nn">..utils.class_or_instance</span> <span class="kn">import</span> <span class="n">class_or_instance</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">async_to_sync</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">conf</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hips2fits&#39;</span><span class="p">,</span> <span class="s1">&#39;hips2fitsClass&#39;</span><span class="p">]</span>
<span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hips2fitsClass.*&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="hips2fitsClass">
<a class="viewcode-back" href="../../../api/astroquery.hips2fits.hips2fitsClass.html#astroquery.hips2fits.hips2fitsClass">[docs]</a>
<span class="nd">@async_to_sync</span>
<span class="k">class</span> <span class="nc">hips2fitsClass</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query the `CDS hips2fits service &lt;https://alasky.cds.unistra.fr/hips-image-services/hips2fits&gt;`_</span>

<span class="sd">    The `CDS hips2fits service &lt;https://alasky.cds.unistra.fr/hips-image-services/hips2fits&gt;`_ offers a way</span>
<span class="sd">    to extract FITS images from HiPS sky maps. HiPS is an IVOA standard that combines individual images in</span>
<span class="sd">    order to produce a progressive hierarchical sky map describing the whole survey. Please refer to the</span>
<span class="sd">    `IVOA paper &lt;http://www.ivoa.net/documents/HiPS/20170519/REC-HIPS-1.0-20170519.pdf&gt;`_ for more info.</span>

<span class="sd">    Given an astropy user-defined WCS with an HiPS name</span>
<span class="sd">    (see the list of valid HiPS names hosted in CDS `here &lt;https://aladin.cds.unistra.fr/hips/list&gt;`_),</span>
<span class="sd">    hips2fits will return you the corresponding FITS image (JPG/PNG output formats are also implemented).</span>

<span class="sd">    This package implements two methods:</span>

<span class="sd">    * `~astroquery.hips2fits.hips2fitsClass.query_with_wcs` extracting a FITS image from a HiPS and an</span>
<span class="sd">      astropy `~astropy.wcs.WCS`.</span>
<span class="sd">      See `here &lt;https://aladin.cds.unistra.fr/hips/list&gt;`_ all the valid HiPS names hosted in CDS.</span>

<span class="sd">    * `~astroquery.hips2fits.hips2fitsClass.query` extracting a FITS image from a HiPS given the output</span>
<span class="sd">      image pixel size, the center of projection, the type of projection and the field of view.</span>
<span class="sd">      See `here &lt;https://aladin.cds.unistra.fr/hips/list&gt;`_ all the valid HiPS names hosted in CDS.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">server</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">timeout</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="hips2fitsClass.query_with_wcs">
<a class="viewcode-back" href="../../../api/astroquery.hips2fits.hips2fitsClass.html#astroquery.hips2fits.hips2fitsClass.query_with_wcs">[docs]</a>
    <span class="k">def</span> <span class="nf">query_with_wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hips</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fits&quot;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">99.5</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                       <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the `CDS hips2fits service &lt;https://alasky.cds.unistra.fr/hips-image-services/hips2fits&gt;`_ with an</span>
<span class="sd">        astropy WCS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hips : str</span>
<span class="sd">            ID or keyword identifying the HiPS to use.</span>
<span class="sd">            If multiple HiPS surveys match, one is chosen randomly.</span>
<span class="sd">            See the list of valid HiPS ids hosted by the CDS `here &lt;https://aladin.cds.unistra.fr/hips/list&gt;`_.</span>
<span class="sd">        wcs : `~astropy.wcs.WCS`</span>
<span class="sd">            An astropy WCS defining the astrometry you wish.</span>
<span class="sd">            Alternatively, you can pass lon, lat, fov, coordsys keywords.</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            Format of the output image.</span>
<span class="sd">            Allowed values are fits (default), jpg and png</span>
<span class="sd">            In case of jpg or png format, scaling of the pixels value can be controlled with parameters ``min_cut``,</span>
<span class="sd">            ``max_cut`` and ``stretch``</span>
<span class="sd">        min_cut : float, optional</span>
<span class="sd">            Minimal value considered for contrast adjustment normalization.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Can be given as a percentile value, for example min_cut=1.5%. Default value is 0.5%.</span>
<span class="sd">        max_cut : float, optional</span>
<span class="sd">            Maximal value considered for contrast adjustment normalization.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Can be given as a percentile value, for example max_cut=97%. Default value is 99.5%.</span>
<span class="sd">        stretch : str, optional</span>
<span class="sd">            Stretch function used for contrast adjustment.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Possible values are: power, linear, sqrt, log, asinh. Default value is linear.</span>
<span class="sd">        cmap : `~matplotlib.colors.Colormap` or str, optional</span>
<span class="sd">            Name of the color map.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Any colormap supported by Matplotlib can be specified.</span>
<span class="sd">            Default value is Greys_r (grayscale)</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, returns a dictionary of the query payload instead of the parsed response.</span>
<span class="sd">        verbose : bool, optional</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : `~astropy.io.fits.HDUList` or `~numpy.ndarray`</span>
<span class="sd">            Returns an astropy HDUList for fits output format or a 3-dimensional numpy array</span>
<span class="sd">            for jpg/png output formats.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.hips2fits import hips2fits</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from matplotlib.colors import Colormap</span>
<span class="sd">        &gt;&gt;&gt; from astropy import wcs as astropy_wcs</span>
<span class="sd">        &gt;&gt;&gt; # Create a new WCS astropy object</span>
<span class="sd">        &gt;&gt;&gt; w = astropy_wcs.WCS(header={</span>
<span class="sd">        ...     &#39;NAXIS1&#39;:                 2000,  # Width of the output fits/image</span>
<span class="sd">        ...     &#39;NAXIS2&#39;:                 1000,  # Height of the output fits/image</span>
<span class="sd">        ...     &#39;WCSAXES&#39;:                   2,  # Number of coordinate axes</span>
<span class="sd">        ...     &#39;CRPIX1&#39;:                1000.0, # Pixel coordinate of reference point</span>
<span class="sd">        ...     &#39;CRPIX2&#39;:                500.0,  # Pixel coordinate of reference point</span>
<span class="sd">        ...     &#39;CDELT1&#39;:                -0.18,  # [deg] Coordinate increment at reference point</span>
<span class="sd">        ...     &#39;CDELT2&#39;:                 0.18,  # [deg] Coordinate increment at reference point</span>
<span class="sd">        ...     &#39;CUNIT1&#39;: &#39;deg&#39;,                 # Units of coordinate increment and value</span>
<span class="sd">        ...     &#39;CUNIT2&#39;: &#39;deg&#39;,                 # Units of coordinate increment and value</span>
<span class="sd">        ...     &#39;CTYPE1&#39;: &#39;GLON-MOL&#39;,            # galactic longitude, Mollweide&#39;s projection</span>
<span class="sd">        ...     &#39;CTYPE2&#39;: &#39;GLAT-MOL&#39;,            # galactic latitude, Mollweide&#39;s projection</span>
<span class="sd">        ...     &#39;CRVAL1&#39;:                  0.0,  # [deg] Coordinate value at reference point</span>
<span class="sd">        ...     &#39;CRVAL2&#39;:                  0.0,  # [deg] Coordinate value at reference point</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; hips = &#39;CDS/P/DSS2/red&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = hips2fits.query_with_wcs(</span>
<span class="sd">        ...    hips=hips,</span>
<span class="sd">        ...    wcs=w,</span>
<span class="sd">        ...    get_query_payload=False,</span>
<span class="sd">        ...    format=&#39;jpg&#39;,</span>
<span class="sd">        ...    min_cut=0.5,</span>
<span class="sd">        ...    max_cut=99.5,</span>
<span class="sd">        ...    cmap=Colormap(&#39;viridis&#39;),</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; im = plt.imshow(result)</span>
<span class="sd">        &gt;&gt;&gt; plt.show(im)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_with_wcs_async</span><span class="p">(</span><span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span> <span class="n">hips</span><span class="o">=</span><span class="n">hips</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="n">wcs</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
                                             <span class="n">min_cut</span><span class="o">=</span><span class="n">min_cut</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="n">max_cut</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">stretch</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_result</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="hips2fitsClass.query_with_wcs_async">
<a class="viewcode-back" href="../../../api/astroquery.hips2fits.hips2fitsClass.html#astroquery.hips2fits.hips2fitsClass.query_with_wcs_async">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_with_wcs_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># primarily for debug purposes, but also useful if you want to send</span>
        <span class="c1"># someone a URL linking directly to the data</span>
        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="hips2fitsClass.query">
<a class="viewcode-back" href="../../../api/astroquery.hips2fits.hips2fitsClass.html#astroquery.hips2fits.hips2fitsClass.query">[docs]</a>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hips</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">fov</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
              <span class="n">coordsys</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">rotation_angle</span><span class="o">=</span><span class="n">Angle</span><span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fits&quot;</span><span class="p">,</span>
              <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">99.5</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
              <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the `CDS hips2fits service &lt;https://alasky.cds.unistra.fr/hips-image-services/hips2fits&gt;`_.</span>

<span class="sd">        If you have not any WCS, you can call this method by passing:</span>
<span class="sd">        * The width/height size of the output pixel image</span>
<span class="sd">        * The center of projection in world coordinates (ra, dec)</span>
<span class="sd">        * The fov angle in world coordinates</span>
<span class="sd">        * The rotation angle of the projection</span>
<span class="sd">        * The name of the projection.</span>

<span class="sd">        All `astropy projections &lt;https://docs.astropy.org/en/stable/wcs/supported_projections.html&gt;`_ are supported.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hips : str</span>
<span class="sd">            ID or keyword identifying the HiPS to use.</span>
<span class="sd">            If multiple HiPS surveys match, one is chosen randomly.</span>
<span class="sd">            See the list of valid HiPS ids hosted by the CDS `here &lt;https://aladin.cds.unistra.fr/hips/list&gt;`_.</span>
<span class="sd">        width : int</span>
<span class="sd">            Width in pixels of the output image.</span>
<span class="sd">        height : int</span>
<span class="sd">            Height in pixels of the output image.</span>
<span class="sd">        projection : str</span>
<span class="sd">            Name of the requested projection, eg: SIN, TAN, MOL, AIT, CAR, CEA, STG</span>
<span class="sd">            Compulsory if wcs is not provided.</span>
<span class="sd">            See `this page &lt;https://docs.astropy.org/en/stable/wcs/supported_projections.html&gt;`_ for an exhaustive list.</span>
<span class="sd">        fov : `~astropy.coordinates.Angle`</span>
<span class="sd">            Size (FoV) of the cutout on the sky.</span>
<span class="sd">            This is the size of the largest dimension of the image.</span>
<span class="sd">        ra : `~astropy.coordinates.Longitude`</span>
<span class="sd">            Right ascension of the center of the output image.</span>
<span class="sd">        dec : `~astropy.coordinates.Latitude`</span>
<span class="sd">            Declination of the center of the output image.</span>
<span class="sd">        coordsys : str, optional</span>
<span class="sd">            Coordinate frame system to be used for the projection</span>
<span class="sd">            Possible values are icrs or galactic.</span>
<span class="sd">            Default value is icrs.</span>
<span class="sd">        rotation_angle : `~astropy.coordinates.Angle`, optional</span>
<span class="sd">            Angle value to be applied to the projection</span>
<span class="sd">            Default value is ``Angle(0 * u.deg)``</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            Format of the output image.</span>
<span class="sd">            Allowed values are fits (default), jpg and png</span>
<span class="sd">            In case of jpg or png format, scaling of the pixels value can be controlled with parameters ``min_cut``,</span>
<span class="sd">            ``max_cut`` and ``stretch``</span>
<span class="sd">        min_cut : float, optional</span>
<span class="sd">            Minimal value considered for contrast adjustment normalization.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Can be given as a percentile value, for example min_cut=1.5%. Default value is 0.5%.</span>
<span class="sd">        max_cut : float, optional</span>
<span class="sd">            Maximal value considered for contrast adjustment normalization.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Can be given as a percentile value, for example max_cut=97%. Default value is 99.5%.</span>
<span class="sd">        stretch : str, optional</span>
<span class="sd">            Stretch function used for contrast adjustment.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Possible values are: power, linear, sqrt, log, asinh. Default value is linear.</span>
<span class="sd">        cmap : `~matplotlib.colors.Colormap` or str, optional</span>
<span class="sd">            Name of the color map.</span>
<span class="sd">            Only applicable to jpg/png output formats.</span>
<span class="sd">            Any colormap supported by Matplotlib can be specified.</span>
<span class="sd">            Default value is Greys_r (grayscale)</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            If True, returns a dictionary of the query payload instead of the parsed response.</span>
<span class="sd">        verbose : bool, optional</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : `~astropy.io.fits.HDUList` or `~numpy.ndarray`</span>
<span class="sd">            Returns an astropy HDUList for fits output format or a 3-dimensional numpy array</span>
<span class="sd">            for jpg/png output formats.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from astroquery.hips2fits import hips2fits</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from matplotlib.colors import Colormap</span>
<span class="sd">        &gt;&gt;&gt; import astropy.units as u</span>
<span class="sd">        &gt;&gt;&gt; from astropy.coordinates import Longitude, Latitude, Angle</span>
<span class="sd">        &gt;&gt;&gt; hips = &#39;CDS/P/DSS2/red&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = hips2fits.query(</span>
<span class="sd">        ...    hips=hips,</span>
<span class="sd">        ...    width=1000,</span>
<span class="sd">        ...    height=500,</span>
<span class="sd">        ...    ra=Longitude(0 * u.deg),</span>
<span class="sd">        ...    dec=Latitude(20 * u.deg),</span>
<span class="sd">        ...    fov=Angle(80 * u.deg),</span>
<span class="sd">        ...    projection=&quot;TAN&quot;,</span>
<span class="sd">        ...    get_query_payload=False,</span>
<span class="sd">        ...    format=&#39;jpg&#39;,</span>
<span class="sd">        ...    min_cut=0.5,</span>
<span class="sd">        ...    max_cut=99.5,</span>
<span class="sd">        ...    cmap=Colormap(&#39;viridis&#39;),</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; im = plt.imshow(result)</span>
<span class="sd">        &gt;&gt;&gt; plt.show(im)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_async</span><span class="p">(</span><span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span> <span class="n">hips</span><span class="o">=</span><span class="n">hips</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                                    <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span> <span class="n">fov</span><span class="o">=</span><span class="n">fov</span><span class="p">,</span> <span class="n">coordsys</span><span class="o">=</span><span class="n">coordsys</span><span class="p">,</span>
                                    <span class="n">rotation_angle</span><span class="o">=</span><span class="n">rotation_angle</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="n">min_cut</span><span class="p">,</span>
                                    <span class="n">max_cut</span><span class="o">=</span><span class="n">max_cut</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="n">stretch</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_result</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="hips2fitsClass.query_async">
<a class="viewcode-back" href="../../../api/astroquery.hips2fits.hips2fitsClass.html#astroquery.hips2fits.hips2fitsClass.query_async">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args_to_payload</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># primarily for debug purposes, but also useful if you want to send</span>
        <span class="c1"># someone a URL linking directly to the data</span>
        <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">request_payload</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span></div>


    <span class="k">def</span> <span class="nf">_parse_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="c1"># Parse the json string result</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># Error code status</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c1"># Print a good user message based on what the</span>
            <span class="c1"># server returned</span>
            <span class="c1"># The server returns a dict with two items:</span>
            <span class="c1"># - The title of the error</span>
            <span class="c1"># - A little description of the error</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The request succeeded</span>
            <span class="n">bytes_str</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
            <span class="c1"># Check the format. At this point, we are sure</span>
            <span class="c1"># that the format is correct i.e. either, fits, jpg or png</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
                <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">bytes_str</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">hdul</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># jpg/png formats</span>
                <span class="nb">bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">bytes_str</span><span class="p">)</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_args_to_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Convert arguments to a valid requests payload</span>
        <span class="c1"># Build the payload</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># If a wcs is still present in the kwargs it means</span>
        <span class="c1"># the user called query_with_wcs</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wcs&#39;</span><span class="p">):</span>
            <span class="n">wcs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wcs&#39;</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">to_header</span><span class="p">()</span>

            <span class="c1"># hips2fits needs the size of the output image</span>
            <span class="k">if</span> <span class="n">wcs</span><span class="o">.</span><span class="n">pixel_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">pixel_shape</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The wcs does not contain the size of the image</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The WCS passed does not contain the size of the pixel image.</span>
<span class="s2">                Please add it to the WCS or refer to the query method.&quot;&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Add the WCS to the payload</span>
            <span class="n">header_json</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">header_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">header_json</span><span class="p">)</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;wcs&#39;</span><span class="p">:</span> <span class="n">header_str</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The user called query</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">),</span>
                <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">),</span>
                <span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;projection&quot;</span><span class="p">),</span>
                <span class="s1">&#39;coordsys&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coordsys&quot;</span><span class="p">),</span>
                <span class="s1">&#39;rotation_angle&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rotation_angle&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span>
                <span class="s1">&#39;ra&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span>
                <span class="s1">&#39;dec&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span>
                <span class="s1">&#39;fov&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fov&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span>
            <span class="p">})</span>

        <span class="c1"># Min-cut</span>
        <span class="n">min_cut_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;min_cut&#39;</span><span class="p">)</span>
        <span class="n">min_cut_kw</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_cut_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;min_cut&#39;</span><span class="p">:</span> <span class="n">min_cut_kw</span><span class="p">})</span>

        <span class="c1"># Max-cut</span>
        <span class="n">max_cut_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_cut&#39;</span><span class="p">)</span>
        <span class="n">max_cut_kw</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_cut_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;max_cut&#39;</span><span class="p">:</span> <span class="n">max_cut_kw</span><span class="p">})</span>

        <span class="c1"># Colormap</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Colormap</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">):</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">name</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">})</span>

        <span class="c1"># Stretch</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stretch&#39;</span><span class="p">)</span>
        <span class="c1"># TODO remove that: it must be handled properly by the server side</span>
        <span class="c1"># that should return a json error</span>
        <span class="k">if</span> <span class="n">stretch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;stretch: must either &#39;power&#39;, &#39;linear&#39;, &#39;sqrt&#39;, &#39;log&#39; or &#39;asinh&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is ignored.&#39;</span>

            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">AstropyUserWarning</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;stretch&#39;</span><span class="p">:</span> <span class="n">stretch</span><span class="p">})</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;stretch&#39;</span><span class="p">:</span> <span class="n">stretch</span><span class="p">})</span>

        <span class="c1"># HiPS</span>
        <span class="n">hips</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hips&quot;</span><span class="p">)</span>
        <span class="c1"># Output format</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;hips&quot;</span><span class="p">:</span> <span class="n">hips</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="c1"># Check that all the arguments have been handled</span>
        <span class="k">assert</span> <span class="n">kwargs</span> <span class="o">==</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">payload</span></div>



<span class="n">hips2fits</span> <span class="o">=</span> <span class="n">hips2fitsClass</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, The Astroquery Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 11 Dec 2023. <br/>
  </p>
</footer>
  </body>
</html>