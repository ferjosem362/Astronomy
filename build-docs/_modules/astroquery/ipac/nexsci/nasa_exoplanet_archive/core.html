<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>astroquery.ipac.nexsci.nasa_exoplanet_archive.core &#8212; astroquery v0.4.7.dev9024</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/bootstrap-astropy.css?v=9d21690f" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/plot_directive.css" />
    
    <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../../../_static/documentation_options.js?v=4195d067"></script>
    <script src="../../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="text/javascript" src="../../../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../../../_static/copybutton.js"></script>
    <link rel="icon" href="../../../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../../index.html"><span id="logotext1">astro</span><span id="logotext2">query</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../../index.html">astroquery v0.4.7.dev9024</a>
	 &#187;
      </li>
      <li><a href="../../../../index.html" >Module code</a> &#187;</li>
      <li><a href="../nasa_exoplanet_archive.html" accesskey="U">astroquery.ipac.nexsci.nasa_exoplanet_archive</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astroquery.ipac.nexsci.nasa_exoplanet_archive.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>

<span class="c1"># Basic imports</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># Import various astropy modules</span>
<span class="kn">import</span> <span class="nn">astropy.coordinates</span> <span class="k">as</span> <span class="nn">coord</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">astropy.units.cds</span> <span class="k">as</span> <span class="nn">cds</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.io.votable</span> <span class="kn">import</span> <span class="n">parse_single_table</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span> <span class="nn">astropy.utils.exceptions</span> <span class="kn">import</span> <span class="n">AstropyWarning</span>

<span class="c1"># Import astroquery utilities</span>
<span class="kn">from</span> <span class="nn">astroquery.exceptions</span> <span class="kn">import</span> <span class="n">InputWarning</span><span class="p">,</span> <span class="n">InvalidQueryError</span><span class="p">,</span> <span class="n">NoResultsWarning</span><span class="p">,</span> <span class="n">RemoteServiceError</span>
<span class="kn">from</span> <span class="nn">astroquery.query</span> <span class="kn">import</span> <span class="n">BaseQuery</span><span class="p">,</span> <span class="n">BaseVOQuery</span>
<span class="kn">from</span> <span class="nn">astroquery.utils</span> <span class="kn">import</span> <span class="n">async_to_sync</span><span class="p">,</span> <span class="n">commons</span>
<span class="kn">from</span> <span class="nn">astroquery.utils.class_or_instance</span> <span class="kn">import</span> <span class="n">class_or_instance</span>
<span class="kn">from</span> <span class="nn">astroquery.ipac.nexsci.nasa_exoplanet_archive</span> <span class="kn">import</span> <span class="n">conf</span>

<span class="c1"># Import TAP client</span>
<span class="kn">import</span> <span class="nn">pyvo</span>

<span class="c1"># Objects exported when calling from astroquery.ipac.nexsci.nasa_exoplanet_archive import *</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NasaExoplanetArchive&quot;</span><span class="p">,</span> <span class="s2">&quot;NasaExoplanetArchiveClass&quot;</span><span class="p">]</span>

<span class="c1"># Dictionary mapping unit strings to astropy units</span>
<span class="n">UNIT_MAPPER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;--&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;BJD&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: optionally support mapping columns to Time objects</span>
    <span class="s2">&quot;BKJD&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO: optionally support mapping columns to Time objects</span>
    <span class="s2">&quot;D_L&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="s2">&quot;D_S&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">,</span>
    <span class="s2">&quot;Earth flux&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">L_sun</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;Earth Flux&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">L_sun</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;Fearth&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">L_sun</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;M_E&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_earth</span><span class="p">,</span>
    <span class="s2">&quot;Earth Mass&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_earth</span><span class="p">,</span>
    <span class="s2">&quot;Mearth&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_earth</span><span class="p">,</span>
    <span class="s2">&quot;M_J&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_jupiter</span><span class="p">,</span>
    <span class="s2">&quot;Mjupiter&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_jupiter</span><span class="p">,</span>
    <span class="s2">&quot;Jupiter Mass&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_jupiter</span><span class="p">,</span>
    <span class="s2">&quot;R_Earth&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_earth</span><span class="p">,</span>  <span class="c1"># Add u.R_jupiter</span>
    <span class="s2">&quot;Rearth&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_earth</span><span class="p">,</span>
    <span class="s2">&quot;Earth Radius&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_earth</span><span class="p">,</span>
    <span class="s2">&quot;Jupiter Radius&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_jupiter</span><span class="p">,</span>
    <span class="s2">&quot;Rjupiter&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_jupiter</span><span class="p">,</span>
    <span class="s2">&quot;Searth&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">L_sun</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;R_Sun&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_sun</span><span class="p">,</span>
    <span class="s2">&quot;Rstar&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_sun</span><span class="p">,</span>
    <span class="s2">&quot;a_perp&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">au</span><span class="p">,</span>
    <span class="s2">&quot;arc-sec/year&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">yr</span><span class="p">,</span>
    <span class="s2">&quot;cm/s**2&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;g/cm**3&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
    <span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
    <span class="s2">&quot;degrees&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span>
    <span class="s2">&quot;dexincgs&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;hours&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">,</span>
    <span class="s2">&quot;hrs&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">hr</span><span class="p">,</span>
    <span class="s2">&quot;kelvin&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
    <span class="s2">&quot;logLsun&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">L_sun</span><span class="p">),</span>
    <span class="s2">&quot;log(Lsun)&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">L_sun</span><span class="p">),</span>
    <span class="s2">&quot;log(Solar)&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">L_sun</span><span class="p">),</span>
    <span class="s2">&quot;mags&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">mag</span><span class="p">,</span>
    <span class="s2">&quot;microas&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">uas</span><span class="p">,</span>
    <span class="s2">&quot;perc&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">percent</span><span class="p">,</span>
    <span class="s2">&quot;pi_E&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pi_EE&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pi_EN&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;pi_rel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;ppm&quot;</span><span class="p">:</span> <span class="n">cds</span><span class="o">.</span><span class="n">ppm</span><span class="p">,</span>
    <span class="s2">&quot;seconds&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
    <span class="s2">&quot;Solar mass&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span><span class="p">,</span>
    <span class="s2">&quot;solarradius&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_sun</span><span class="p">,</span>
    <span class="s2">&quot;Solar Radius&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">R_sun</span><span class="p">,</span>
    <span class="s2">&quot;log10(cm/s**2)&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;log(cm/s**2)&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s2">&quot;dex&quot;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">dex</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="s2">&quot;sexagesimal&quot;</span><span class="p">:</span> <span class="kc">None</span>
<span class="p">}</span>

<span class="n">CONVERTERS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">koi_quarters</span><span class="o">=</span><span class="p">[</span><span class="n">ascii</span><span class="o">.</span><span class="n">convert_numpy</span><span class="p">(</span><span class="nb">str</span><span class="p">)])</span>

<span class="c1"># &#39;ps&#39; and &#39;pscomppars&#39; are the main tables of detected exoplanets.</span>
<span class="c1"># Calls to the old tables (&#39;exoplanets&#39;, &#39;compositepars&#39;, &#39;exomultpars&#39;) will</span>
<span class="c1"># return errors and urge the user to call the &#39;ps&#39; or &#39;pscomppars&#39; tables</span>
<span class="n">OBJECT_TABLES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ps&quot;</span><span class="p">:</span> <span class="s2">&quot;pl_&quot;</span><span class="p">,</span> <span class="s2">&quot;pscomppars&quot;</span><span class="p">:</span> <span class="s2">&quot;pl_&quot;</span><span class="p">,</span> <span class="s2">&quot;exoplanets&quot;</span><span class="p">:</span> <span class="s2">&quot;pl_&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;compositepars&quot;</span><span class="p">:</span> <span class="s2">&quot;fpl_&quot;</span><span class="p">,</span> <span class="s2">&quot;exomultpars&quot;</span><span class="p">:</span> <span class="s2">&quot;mpl_&quot;</span><span class="p">}</span>
<span class="n">MAP_TABLEWARNINGS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;exoplanets&quot;</span><span class="p">:</span> <span class="s2">&quot;Planetary Systems (PS)&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;compositepars&quot;</span><span class="p">:</span> <span class="s2">&quot;Planetary System Composite Parameters table (PSCompPars)&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;exomultpars&quot;</span><span class="p">:</span> <span class="s2">&quot;Planetary Systems (PS)&quot;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">get_access_url</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s1">&#39;tap&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">service</span> <span class="o">==</span> <span class="s1">&#39;tap&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">url_tap</span>
    <span class="k">elif</span> <span class="n">service</span> <span class="o">==</span> <span class="s1">&#39;api&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">url_api</span>
    <span class="k">elif</span> <span class="n">service</span> <span class="o">==</span> <span class="s1">&#39;aliaslookup&#39;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">url_aliaslookup</span>
    <span class="k">return</span> <span class="n">url</span>


<span class="k">def</span> <span class="nf">get_tap_tables</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tables accessed by API are gradually migrating to TAP service. Generate current list of tables in TAP.&quot;&quot;&quot;</span>
    <span class="n">tap</span> <span class="o">=</span> <span class="n">pyvo</span><span class="o">.</span><span class="n">dal</span><span class="o">.</span><span class="n">tap</span><span class="o">.</span><span class="n">TAPService</span><span class="p">(</span><span class="n">baseurl</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">url_tap</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">tap</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;select * from TAP_SCHEMA.tables&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;ADQL&quot;</span><span class="p">)</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;table_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="s2">&quot;TAP_SCHEMA.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">tables</span>


<span class="k">class</span> <span class="nc">InvalidTableError</span><span class="p">(</span><span class="n">InvalidQueryError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception thrown if the given table is not recognized by the Exoplanet Archive Servers&quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="c1"># Class decorator, async_to_sync, modifies NasaExoplanetArchiveClass to convert</span>
<span class="c1"># all query_x_async methods to query_x methods</span>
<div class="viewcode-block" id="NasaExoplanetArchiveClass">
<a class="viewcode-back" href="../../../../../api/astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.html#astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass">[docs]</a>
<span class="nd">@async_to_sync</span>
<span class="k">class</span> <span class="nc">NasaExoplanetArchiveClass</span><span class="p">(</span><span class="n">BaseVOQuery</span><span class="p">,</span> <span class="n">BaseQuery</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The interface for querying the NASA Exoplanet Archive TAP and API services</span>

<span class="sd">    A full discussion of the available tables and query syntax is available on the documentation</span>
<span class="sd">    pages for `TAP &lt;https://exoplanetarchive.ipac.caltech.edu/docs/TAP/usingTAP.html&gt;`_ and</span>
<span class="sd">    `API &lt;https://exoplanetarchive.ipac.caltech.edu/docs/program_interfaces.html&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># When module us imported, __init__.py runs and loads a configuration object,</span>
    <span class="c1"># setting the configuration parameters conf.url, conf.timeout and conf.cache</span>
    <span class="n">URL_API</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">url_api</span>
    <span class="n">URL_TAP</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">url_tap</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">timeout</span>
    <span class="n">CACHE</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">cache</span>

    <span class="c1"># Make TAP_TABLES an attribute of NasaExoplanetArchiveClass</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">TAP_TABLES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_tap_tables&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tap_tables</span> <span class="o">=</span> <span class="n">get_tap_tables</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tap_tables</span>

    <span class="c1"># Ensures methods can be called either as class methods or instance methods. This is the basic query method.</span>
<div class="viewcode-block" id="NasaExoplanetArchiveClass.query_criteria_async">
<a class="viewcode-back" href="../../../../../api/astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.html#astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.query_criteria_async">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_criteria_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">criteria</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search a table given a set of criteria or return the full table</span>

<span class="sd">        The syntax for these queries is described on the Exoplanet Archive TAP[1]_ API[2]_ documentation pages.</span>
<span class="sd">        In particular, the most commonly used criteria will be ``select`` and ``where``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table : str</span>
<span class="sd">            The name of the table to query. A list of the tables on the Exoplanet Archive can be</span>
<span class="sd">            found on the documentation pages [1]_, [2]_.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            Just return the dict of HTTP request parameters. Defaults to ``False``.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Should the request result be cached? This can be useful for large repeated queries,</span>
<span class="sd">            but since the data in the archive is updated regularly, this defaults to ``False``.</span>
<span class="sd">        **criteria</span>
<span class="sd">            The filtering criteria to apply. These are described in detail in the archive</span>
<span class="sd">            documentation [1]_, [2]_ but some examples include ``select=&quot;*&quot;`` to return all columns of</span>
<span class="sd">            the queried table or ``where=pl_name=&#39;K2-18 b&#39;`` to filter a specific column.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : `requests.Response`</span>
<span class="sd">            The HTTP response returned from the service.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [1] `NASA Exoplanet Archive TAP Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/TAP/usingTAP.html&gt;`_</span>
<span class="sd">        .. [2] `NASA Exoplanet Archive API Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/program_interfaces.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure table is lower-case</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Warn if old table is requested</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">MAP_TABLEWARNINGS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidTableError</span><span class="p">(</span>
                <span class="s2">&quot;The `</span><span class="si">{0}</span><span class="s2">` table is no longer updated and has been replacedby the `</span><span class="si">{1}</span><span class="s2">` table, which&quot;</span>
                <span class="s2">&quot; is connected to the Exoplanet Archive TAP service. Although the argument keywords &quot;</span>
                <span class="s2">&quot;of the called method should still work on the new table, the allowed values could &quot;</span>
                <span class="s2">&quot;have changed since the database column names have changed; this document contains &quot;</span>
                <span class="s2">&quot;the current definitions and a mapping between the new and deprecated names: &quot;</span>
                <span class="s2">&quot;https://exoplanetarchive.ipac.caltech.edu/docs/API_PS_columns.html. You might also &quot;</span>
                <span class="s2">&quot;want to review the TAP User Guide for help on creating a new query for the most &quot;</span>
                <span class="s2">&quot;current data: https://exoplanetarchive.ipac.caltech.edu/docs/TAP/usingTAP.html.&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">MAP_TABLEWARNINGS</span><span class="p">[</span><span class="n">table</span><span class="p">]))</span>

        <span class="c1"># Deal with lists of columns instead of comma separated strings</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">criteria</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;select&quot;</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;select&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">select</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
            <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;select&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">select</span>

        <span class="c1"># We prefer to work with IPAC format so that we get units, but everything it should work</span>
        <span class="c1"># with the other options too</span>
        <span class="c1"># Get the format, or set it to &quot;ipac&quot; if not given. Makes more sense to use CSV here.</span>
        <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">criteria</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;ipac&quot;</span><span class="p">)</span>
        <span class="c1"># Less formats are allowed for TAP, so this needs to be updated. Default</span>
        <span class="c1"># is VOTable (vot?, xml?), also csv and tsv are allowed</span>
        <span class="k">if</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;The &#39;json&#39; format is not supported&quot;</span><span class="p">)</span>

        <span class="c1"># Build the query</span>
        <span class="n">request_payload</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="o">**</span><span class="n">criteria</span><span class="p">)</span>

        <span class="c1"># Use the default cache setting if one was not provided</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CACHE</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAP_TABLES</span><span class="p">:</span>
            <span class="n">tap</span> <span class="o">=</span> <span class="n">pyvo</span><span class="o">.</span><span class="n">dal</span><span class="o">.</span><span class="n">tap</span><span class="o">.</span><span class="n">TAPService</span><span class="p">(</span><span class="n">baseurl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">URL_TAP</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">)</span>
            <span class="c1"># construct query from table and request_payload (including format)</span>
            <span class="n">tap_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_to_sql</span><span class="p">(</span><span class="n">request_payload</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tap_query</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">tap</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">tap_query</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;ADQL&#39;</span><span class="p">)</span>  <span class="c1"># Note that this returns a VOTable</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_query_payload</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">request_payload</span>

            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request</span><span class="p">(</span>
                <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">URL_API</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">request_payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">requested_format</span> <span class="o">=</span> <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">response</span></div>


    <span class="c1"># This is the region query method</span>
<div class="viewcode-block" id="NasaExoplanetArchiveClass.query_region_async">
<a class="viewcode-back" href="../../../../../api/astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.html#astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.query_region_async">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_region_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">criteria</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter a table using a cone search around specified coordinates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table : str</span>
<span class="sd">            The name of the table to query. A list of the tables on the Exoplanet Archive can be</span>
<span class="sd">            found on the documentation pages [1]_, [2]_.</span>
<span class="sd">        coordinates : str or `~astropy.coordinates`</span>
<span class="sd">            The coordinates around which to query.</span>
<span class="sd">        radius : str or `~astropy.units.Quantity`</span>
<span class="sd">            The radius of the cone search. Assumed to be have units of degrees if not provided as</span>
<span class="sd">            a ``Quantity``.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            Just return the dict of HTTP request parameters. Defaults to ``False``.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Should the request result be cached? This can be useful for large repeated queries,</span>
<span class="sd">            but since the data in the archive is updated regularly, this defaults to ``False``.</span>
<span class="sd">        **criteria</span>
<span class="sd">            Any other filtering criteria to apply. These are described in detail in the archive</span>
<span class="sd">            documentation [1]_,[2]_ but some examples include ``select=&quot;*&quot;`` to return all columns of</span>
<span class="sd">            the queried table or ``where=pl_name=&#39;K2-18 b&#39;`` to filter a specific column.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : `requests.Response`</span>
<span class="sd">            The HTTP response returned from the service.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [1] `NASA Exoplanet Archive TAP Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/TAP/usingTAP.html&gt;`_</span>
<span class="sd">        .. [2] `NASA Exoplanet Archive API Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/program_interfaces.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checks if coordinate strings is parsable as an astropy.coordinates object</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">commons</span><span class="o">.</span><span class="n">parse_coordinates</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

        <span class="c1"># if radius is just a number we assume degrees</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

        <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span>
        <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> degree&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">radius</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

        <span class="c1"># Runs the query method defined above, but with added region filter</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_criteria_async</span><span class="p">(</span>
            <span class="n">table</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">criteria</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1"># This method queries for a specific object in `exoplanets`, `compositepars`, or `exomultpars` tables.</span>
    <span class="c1"># Needs to be updated</span>
<div class="viewcode-block" id="NasaExoplanetArchiveClass.query_object_async">
<a class="viewcode-back" href="../../../../../api/astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.html#astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.query_object_async">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_object_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regularize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">criteria</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search the tables of confirmed exoplanets for information about a planet or planet host</span>

<span class="sd">        The tables available to this query are the following (more information can be found on</span>
<span class="sd">        the archive&#39;s documentation pages [1]_):</span>

<span class="sd">        - ``ps``: This table compiles parameters derived from a multiple published</span>
<span class="sd">          references on separate rows, each row containing self-consistent values from one reference.</span>
<span class="sd">        - ``pscomppars``: This table compiles all parameters of confirmed exoplanets from multiple,</span>
<span class="sd">          published references in one row (not all self-consistent) per object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object_name : str</span>
<span class="sd">            The name of the planet or star.  If ``regularize`` is ``True``, an attempt will be made</span>
<span class="sd">            to regularize this name using the ``aliastable`` table. Defaults to ``True``.</span>
<span class="sd">        table : [``&quot;ps&quot;`` or ``&quot;pscomppars&quot;``], optional</span>
<span class="sd">            The table to query, must be one of the supported tables: ``&quot;ps&quot;`` or ``&quot;pscomppars&quot;``.</span>
<span class="sd">            Defaults to ``&quot;ps&quot;``.</span>
<span class="sd">        get_query_payload : bool, optional</span>
<span class="sd">            Just return the dict of HTTP request parameters. Defaults to ``False``.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Should the request result be cached? This can be useful for large repeated queries,</span>
<span class="sd">            but since the data in the archive is updated regularly, this defaults to ``False``.</span>
<span class="sd">        regularize : bool, optional</span>
<span class="sd">            If ``True``, the ``aliastable`` will be used to regularize the target name.</span>
<span class="sd">        **criteria</span>
<span class="sd">            Any other filtering criteria to apply. Values provided using the ``where`` keyword will</span>
<span class="sd">            be ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : `requests.Response`</span>
<span class="sd">            The HTTP response returned from the service.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [1] `NASA Exoplanet Archive TAP Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/TAP/usingTAP.html&gt;`_</span>
<span class="sd">        .. [2] `NASA Exoplanet Archive API Documentation</span>
<span class="sd">           &lt;https://exoplanetarchive.ipac.caltech.edu/docs/program_interfaces.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">OBJECT_TABLES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid table &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;. The allowed options are: &#39;ps&#39; and &#39;pscomppars&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">regularize</span><span class="p">:</span>
            <span class="n">object_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regularize_object_name</span><span class="p">(</span><span class="n">object_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;where&quot;</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Any filters using the &#39;where&#39; argument are ignored &quot;</span>
                          <span class="s2">&quot;in ``query_object``. Consider using ``query_criteria`` instead.&quot;</span><span class="p">,</span> <span class="n">InputWarning</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TAP_TABLES</span><span class="p">:</span>
            <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hostname=&#39;</span><span class="si">{1}</span><span class="s2">&#39; OR </span><span class="si">{0}</span><span class="s2">name=&#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">object_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">criteria</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">hostname=&#39;</span><span class="si">{1}</span><span class="s2">&#39; OR </span><span class="si">{0}</span><span class="s2">name=&#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">object_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_criteria_async</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">get_query_payload</span><span class="o">=</span><span class="n">get_query_payload</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">criteria</span><span class="p">)</span></div>


<div class="viewcode-block" id="NasaExoplanetArchiveClass.query_aliases">
<a class="viewcode-back" href="../../../../../api/astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.html#astroquery.ipac.nexsci.nasa_exoplanet_archive.NasaExoplanetArchiveClass.query_aliases">[docs]</a>
    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">query_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for aliases for a given confirmed planet or planet host</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object_name : str</span>
<span class="sd">            The name of a planet or star to regularize using the ``aliaslookup`` service.</span>
<span class="sd">        cache : bool, optional</span>
<span class="sd">            Should the request result be cached? This can be useful for large repeated queries,</span>
<span class="sd">            but since the data in the archive is updated regularly, this defaults to ``False``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        response : list</span>
<span class="sd">            A list of aliases found for the object name. The default name will be listed first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_query_aliases</span><span class="p">(</span><span class="n">object_name</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resolved_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;manifest&#39;</span><span class="p">][</span><span class="s1">&#39;resolved_name&#39;</span><span class="p">]</span>
            <span class="n">resolved_name_split</span> <span class="o">=</span> <span class="n">resolved_name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">system_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;manifest&#39;</span><span class="p">][</span><span class="s1">&#39;system_name&#39;</span><span class="p">]</span>
            <span class="n">n_stars</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;manifest&#39;</span><span class="p">][</span><span class="s1">&#39;system_snapshot&#39;</span><span class="p">][</span><span class="s1">&#39;number_of_stars&#39;</span><span class="p">]</span>

            <span class="c1"># Asked for system</span>
            <span class="k">if</span> <span class="n">resolved_name</span> <span class="o">==</span> <span class="n">system_name</span> <span class="ow">and</span> <span class="n">n_stars</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">][</span><span class="s1">&#39;system_info&#39;</span><span class="p">][</span><span class="s1">&#39;alias_set&#39;</span><span class="p">][</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span>
            <span class="c1"># Asked for planet</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resolved_name_split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">resolved_name_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                  <span class="ow">and</span> <span class="n">resolved_name_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">and</span> <span class="n">resolved_name_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">islower</span><span class="p">()):</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">][</span><span class="s1">&#39;objects&#39;</span><span class="p">][</span><span class="s1">&#39;planet_set&#39;</span><span class="p">][</span><span class="s1">&#39;planets&#39;</span><span class="p">][</span><span class="n">resolved_name</span><span class="p">][</span><span class="s1">&#39;alias_set&#39;</span><span class="p">][</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span>
            <span class="c1"># Asked for star</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">][</span><span class="s1">&#39;objects&#39;</span><span class="p">][</span><span class="s1">&#39;stellar_set&#39;</span><span class="p">][</span><span class="s1">&#39;stars&#39;</span><span class="p">][</span><span class="n">resolved_name</span><span class="p">][</span><span class="s1">&#39;alias_set&#39;</span><span class="p">][</span><span class="s1">&#39;aliases&#39;</span><span class="p">]</span>

            <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="n">resolved_name</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">resolved_name</span><span class="p">]))</span>

        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No aliases found for name: &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_name</span><span class="p">),</span> <span class="n">NoResultsWarning</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">aliases</span></div>


    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">_regularize_object_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Regularize the name of a planet or planet host using the ``aliaslookup`` service&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_aliases</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">aliases</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">aliases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No aliases found for name: &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_name</span><span class="p">),</span> <span class="n">NoResultsWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">object_name</span>

    <span class="k">def</span> <span class="nf">_request_query_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service request for query_aliases()&quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_access_url</span><span class="p">(</span><span class="s1">&#39;aliaslookup&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">object_name</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="c1"># Look for response errors. This might need to be updated for TAP</span>
    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the response from a request to see if it failed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            The decoded body of the response.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidColumnError :</span>
<span class="sd">            If ``select`` included an invalid column.</span>
<span class="sd">        InvalidTableError :</span>
<span class="sd">            If the queried ``table`` does not exist.</span>
<span class="sd">        RemoteServiceError :</span>
<span class="sd">            If anything else went wrong.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Error messages will always be formatted starting with the word &quot;ERROR&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Some errors have the form:</span>
        <span class="c1">#   Error type: ...</span>
        <span class="c1">#   Message: ...</span>
        <span class="c1"># so we&#39;ll parse those to try to provide some reasonable feedback to the user</span>
        <span class="n">error_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Error Type:\s(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">error_type</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">continue</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Message:\s(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">error_message</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">continue</span>

        <span class="c1"># If we hit this condition, that means that we weren&#39;t able to parse the error so we&#39;ll</span>
        <span class="c1"># just throw the full response</span>
        <span class="k">if</span> <span class="n">error_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">error_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RemoteServiceError</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># A useful special is if a column name is unrecognized. This has the format</span>
        <span class="c1">#   Error type: SystemError</span>
        <span class="c1">#   Message: ... &quot;NAME_OF_COLUMN&quot;: invalid identifier ...</span>
        <span class="k">if</span> <span class="n">error_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SystemError&quot;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;(.*)&quot;: invalid identifier&#39;</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;&#39;</span><span class="si">{0}</span><span class="s2">&#39; is an invalid identifier. This error can be caused by invalid &quot;</span>
                        <span class="s2">&quot;column names, missing quotes, or other syntax errors&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">error_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;UserError&quot;</span><span class="p">):</span>
            <span class="c1"># Another important one is when the table is not recognized. This has the format:</span>
            <span class="c1">#   Error type: UserError - &quot;table&quot; parameter</span>
            <span class="c1">#   Message: ... &quot;NAME_OF_TABLE&quot; is not a valid table.</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;(.*)&quot; is not a valid table&#39;</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidTableError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{0}</span><span class="s2">&#39; is not a valid table&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

            <span class="k">raise</span> <span class="n">InvalidQueryError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="n">error_message</span><span class="p">))</span>

        <span class="c1"># Finally just return the full error message if we got here</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">RemoteServiceError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fix_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fix any undefined units using a set of hacks</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : `~astropy.table.Table`</span>
<span class="sd">            The original data table without units.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_data : `~astropy.table.QTable` or `~astropy.table.Table`</span>
<span class="sd">            The original ``data`` table with units applied where possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># To deal with masked data and quantities properly, we need to construct the QTable</span>
        <span class="c1"># manually so we&#39;ll loop over the columns and process each one independently</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">column_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">column_masks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">UNIT_MAPPER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1"># Columns with dtype==object/str can&#39;t have units according to astropy</span>
            <span class="c1"># Set unit to None</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span> <span class="ow">and</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span> <span class="ow">and</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">UnrecognizedUnit</span><span class="p">):</span>
                <span class="c1"># some special cases</span>
                <span class="n">unit_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">unit_str</span> <span class="o">==</span> <span class="s2">&quot;earth&quot;</span> <span class="ow">and</span> <span class="s2">&quot;prad&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">R_earth</span>
                <span class="k">elif</span> <span class="n">unit_str</span> <span class="o">==</span> <span class="s2">&quot;solar&quot;</span> <span class="ow">and</span> <span class="s2">&quot;radius&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">R_sun</span>
                <span class="k">elif</span> <span class="n">unit_str</span> <span class="o">==</span> <span class="s2">&quot;solar&quot;</span> <span class="ow">and</span> <span class="s2">&quot;mass&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">M_sun</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mlmag&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mlext&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mlcol&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mlred&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">mag</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: nocover</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized unit: &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39; for column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">AstropyWarning</span><span class="p">)</span>

            <span class="c1"># Unmask since astropy doesn&#39;t like masked values in columns with units</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">column_masks</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">column_masks</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
            <span class="n">column_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

        <span class="c1"># Build the new `QTable` and copy over the data masks if there are any</span>
        <span class="c1"># Some units cannot be used for MaskedQuantities, we catch the specific UserWarning</span>
        <span class="c1"># about them here as the end user can do nothing about this</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">colnames_to_ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;surface_gravity&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lum&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lumerr1&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lumerr2&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;st_logg&#39;</span><span class="p">,</span> <span class="s1">&#39;st_loggerr1&#39;</span><span class="p">,</span> <span class="s1">&#39;st_loggerr2&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">colnames_to_ignore</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1"> has a unit but&#39;</span><span class="p">,</span>
                                        <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">QTable</span><span class="p">(</span><span class="n">column_data</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">column_names</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">column_masks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">column_masks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_parse_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the result of a `~requests.Response` (from API) or `pyvo.dal.tap.TAPResults` (from TAP) object</span>
<span class="sd">        and return an `~astropy.table.Table`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        response : `~requests.Response` or `pyvo.dal.tap.TAPResults`</span>
<span class="sd">            The response from the server.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            Currently has no effect.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : `~astropy.table.Table` or `~astropy.table.QTable`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">pyvo</span><span class="o">.</span><span class="n">dal</span><span class="o">.</span><span class="n">tap</span><span class="o">.</span><span class="n">TAPResults</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
            <span class="c1"># TODO: implement format conversion for TAP return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Extract the decoded body of the response</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

            <span class="c1"># Raise an exception if anything went wrong</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

            <span class="c1"># Parse the requested format to figure out how to parse the returned data.</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">requested_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;ascii&quot;</span> <span class="ow">in</span> <span class="n">fmt</span> <span class="ow">or</span> <span class="s2">&quot;ipac&quot;</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;ipac&quot;</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="n">CONVERTERS</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;csv&quot;</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="n">CONVERTERS</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;bar&quot;</span> <span class="ow">in</span> <span class="n">fmt</span> <span class="ow">or</span> <span class="s2">&quot;pipe&quot;</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="n">CONVERTERS</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;xml&quot;</span> <span class="ow">in</span> <span class="n">fmt</span> <span class="ow">or</span> <span class="s2">&quot;table&quot;</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">parse_single_table</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="n">CONVERTERS</span><span class="p">)</span>

        <span class="c1"># Fix any undefined units</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_units</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># For backwards compatibility, add a `sky_coord` column with the coordinates of the object</span>
        <span class="c1"># if possible</span>
        <span class="k">if</span> <span class="s2">&quot;ra&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s2">&quot;dec&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sky_coord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">dec</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Query returned no results.&quot;</span><span class="p">,</span> <span class="n">NoResultsWarning</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@class_or_instance</span>
    <span class="k">def</span> <span class="nf">_request_to_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_payload</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert request_payload dict to SQL query string to be parsed by TAP.&quot;&quot;&quot;</span>

        <span class="c1"># Required minimum query string</span>
        <span class="n">query_req</span> <span class="o">=</span> <span class="s2">&quot;select </span><span class="si">{0}</span><span class="s2"> from </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request_payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">),</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;order&quot;</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;order by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;order&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># TODO figure out what to do with the format keyword</span>
            <span class="n">request_payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;ra&quot;</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># means this is a `query_region` call</span>
            <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;contains(point(&#39;icrs&#39;,ra,dec),circle(&#39;icrs&#39;,</span><span class="si">{0}</span><span class="s2">,</span><span class="si">{1}</span><span class="s2">,</span><span class="si">{2}</span><span class="s2">))=1&quot;</span>
                                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span>
                                                <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]))</span>
            <span class="k">del</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;ra&quot;</span><span class="p">],</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">],</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;where&quot;</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pl_hostname&quot;</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]:</span>  <span class="c1"># means this is a `query_object`</span>
                <span class="c1"># This is a bit hacky since we are getting this from the request_payload (downstream)</span>
                <span class="c1"># instead of directly from object_name</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">][</span>
                    <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;OR&quot;</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">request_payload</span><span class="p">[</span><span class="s2">&quot;where&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pl_hostname or pl_name like </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">query_opt</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request_payload</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">tap_query</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query_req</span><span class="p">,</span> <span class="n">query_opt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tap_query</span></div>



<span class="n">NasaExoplanetArchive</span> <span class="o">=</span> <span class="n">NasaExoplanetArchiveClass</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, The Astroquery Developers.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 7.2.6. &nbsp;
    Last built 11 Dec 2023. <br/>
  </p>
</footer>
  </body>
</html>